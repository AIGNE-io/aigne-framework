# æµ‹è¯•ç°çŠ¶åˆ†æä¸æ”¹è¿›å»ºè®®

> åˆ†ææ—¥æœŸ: 2026-01-15

## æ€»ä½“æ¦‚å†µ

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æµ‹è¯•æ–‡ä»¶ | 217 ä¸ª |
| æµ‹è¯•ä»£ç  | 40,048 è¡Œ |
| æµ‹è¯•æ¡†æ¶ | bun:test |
| å¿«ç…§æµ‹è¯• | 27 ä¸ªæ–‡ä»¶ |

---

## æµ‹è¯•è¦†ç›–åˆ†å¸ƒ

### æŒ‰åŒ…åˆ†ç±»

```
packages/     94 files, ~20,000 lines
  - core:           48 files, 11,077 lines
  - cli:            27 files, 6,778 lines
  - agent-library:   5 files, 2,755 lines

afs/          37 files, ~8,500 lines
  - core:           10 files, 1,385 lines â­

models/       47 files, ~6,400 lines

memory/       11 files, ~850 lines

observability/ 14 files, ~1,100 lines
```

---

## è¦†ç›–ç‡é—®é¢˜

### ä¸¥é‡ä¸è¶³çš„åŒ…

| åŒ… | æºç è¡Œ | æµ‹è¯•è¡Œ | æ¯”ä¾‹ | çŠ¶æ€ |
|---|--------|--------|------|------|
| platform-helpers | 125 | 3 | 0.02 | ğŸ”´ ä¸¥é‡ |
| memory/agentic | 174 | 40 | 0.23 | ğŸ”´ ä¸è¶³ |
| memory/user-profile | 277 | 69 | 0.25 | ğŸ”´ ä¸è¶³ |
| afs/explorer | 128 | 49 | 0.38 | ğŸŸ  åä½ |
| packages/sqlite | 206 | 83 | 0.40 | ğŸŸ  åä½ |

### å®Œå…¨æ²¡æœ‰æµ‹è¯•çš„å·¥å…·å‡½æ•°

```
packages/core/src/utils/
â”œâ”€â”€ json-utils.ts          (41 è¡Œ) â† æ— æµ‹è¯•
â”œâ”€â”€ model-utils.ts         (13 è¡Œ) â† æ— æµ‹è¯•
â”œâ”€â”€ promise.ts             (17 è¡Œ) â† æ— æµ‹è¯•
â”œâ”€â”€ role-utils.ts          (39 è¡Œ) â† æ— æµ‹è¯•
â”œâ”€â”€ stream-polyfill.ts     (35 è¡Œ) â† æ— æµ‹è¯•
â””â”€â”€ typed-event-emitter.ts (15 è¡Œ) â† æ— æµ‹è¯•

å…± ~160 è¡Œæœªæµ‹è¯•çš„å·¥å…·ä»£ç 
```

### è¦†ç›–è‰¯å¥½çš„åŒ…ï¼ˆå‚è€ƒï¼‰

| åŒ… | æ¯”ä¾‹ | è¯´æ˜ |
|---|------|------|
| afs/core | 1.66 | ä¼˜ç§€ |
| afs/local-fs | 2.46 | ä¼˜ç§€ |
| secrets | 2.90 | ä¼˜ç§€ï¼ˆå®‰å…¨å…³é”®ï¼‰ |

---

## æµ‹è¯•ç±»å‹åˆ†æ

| ç±»å‹ | æ•°é‡ | è¯´æ˜ |
|------|------|------|
| å•å…ƒæµ‹è¯• | 164 | çº¯å‡½æ•°/ç±»æµ‹è¯•ï¼Œå¸¦ mock |
| é›†æˆæµ‹è¯• | 37 | ç»„ä»¶/æ¨¡å—äº¤äº’ |
| E2E æµ‹è¯• | 16 | å®Œæ•´ç¤ºä¾‹æµç¨‹ |
| è¦†ç›–è¿½è¸ª | 32 | coverage.test.ts æ¨¡å¼ |
| å¿«ç…§æµ‹è¯• | 27 | è¾“å‡ºéªŒè¯ |

---

## å¯è‡ªåŠ¨ç”Ÿæˆçš„æµ‹è¯•

### Tier 1: é«˜ä¼˜å…ˆçº§ï¼ˆ90%+ å¯è‡ªåŠ¨åŒ–ï¼‰

**å·¥å…·å‡½æ•°æµ‹è¯•**

å½“å‰çŠ¶æ€ï¼š
- `camelize.test.ts`: 70 è¡Œæºç  â†’ 295 è¡Œæµ‹è¯• (4.2x)
- 6 ä¸ªå·¥å…·æ–‡ä»¶å®Œå…¨æ— æµ‹è¯•

è‡ªåŠ¨ç”Ÿæˆæ–¹æ³•ï¼š
1. åˆ†æå‡½æ•°ç­¾åå’Œç±»å‹
2. ç”Ÿæˆæ­£å‘ç”¨ä¾‹ã€è¾¹ç•Œç”¨ä¾‹ã€å¼‚å¸¸ç”¨ä¾‹
3. ä½¿ç”¨ Zod schema ç”Ÿæˆå¥‘çº¦æµ‹è¯•

**é¢„ä¼°**: å¯è‡ªåŠ¨ç”Ÿæˆ 30-50% çš„æµ‹è¯•ä»£ç 

### Tier 2: ä¸­ä¼˜å…ˆçº§ï¼ˆ60% å¯è‡ªåŠ¨åŒ–ï¼‰

**Model Provider æµ‹è¯•**

13 ä¸ªæ¨¡å‹åŒ…æœ‰ç›¸ä¼¼æ¨¡å¼ï¼š
```typescript
test("${ModelName} basic usage", async () => {
  const model = new ${ModelName}({ /* options */ });
  spyOn(model, "process").mockReturnValueOnce(/* response */);
  const result = await model.invoke(/* input */);
  expect(result).toEqual(/* output */);
});
```

å¯åˆ›å»ºæ¨¡æ¿ï¼Œå‡å°‘ 40% é‡å¤ä»£ç ã€‚

### Tier 3: ä½ä¼˜å…ˆçº§ï¼ˆ<10% å¯è‡ªåŠ¨åŒ–ï¼‰

- Agent è¡Œä¸ºæµ‹è¯•ï¼ˆä¸šåŠ¡é€»è¾‘å˜åŒ–å¤§ï¼‰
- E2E æµ‹è¯•ï¼ˆç¤ºä¾‹ç‰¹å®šï¼‰
- å¿«ç…§æµ‹è¯•ï¼ˆæ‰‹åŠ¨éªŒè¯ï¼‰

---

## æ”¹è¿›å»ºè®®

### ç«‹å³è¡ŒåŠ¨

1. **å¡«è¡¥ä¸¥é‡ç©ºç™½**
   - platform-helpers: æ·»åŠ  100+ è¡Œæµ‹è¯•
   - 6 ä¸ªæ— æµ‹è¯•å·¥å…·: æ·»åŠ  160+ è¡Œæµ‹è¯•

2. **ç§»é™¤æ— æ•ˆä»£ç **
   - 32 ä¸ª coverage.test.ts æ–‡ä»¶ = 440 è¡Œæ— æ•ˆä»£ç 
   - æ”¹ç”¨ workspace çº§åˆ«è¦†ç›–è¿½è¸ª

3. **åˆ›å»º Model æµ‹è¯•æ¨¡æ¿**
   - 13 ä¸ªæ¨¡å‹åŒ…å…±äº«æ¨¡å¼
   - å‡å°‘ ~500 è¡Œé‡å¤ä»£ç 

### è‡ªåŠ¨ç”Ÿæˆè·¯çº¿å›¾

| é˜¶æ®µ | æ—¶é—´ | å†…å®¹ | äº§å‡º |
|------|------|------|------|
| 1 | 1-2 å‘¨ | æœªæµ‹è¯•å·¥å…·å‡½æ•° | 200-300 è¡Œ |
| 2 | 2-3 å‘¨ | é€šç”¨å·¥å…·æµ‹è¯•ç”Ÿæˆå™¨ | 400-600 è¡Œ |
| 3 | 3-4 å‘¨ | Model æµ‹è¯•æ¨¡æ¿ | 300-500 è¡Œ |
| 4 | 2 å‘¨ | éªŒè¯ä¸ä¼˜åŒ– | - |

**é¢„æœŸæ•ˆæœ**: è‡ªåŠ¨ç”Ÿæˆ 800-1,400 è¡Œæµ‹è¯•ï¼Œç»´æŠ¤è´Ÿæ‹…é™ä½ 15-25%

---

## AI è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•çš„å»ºè®®

### é€‚åˆ AI ç”Ÿæˆçš„æµ‹è¯•

1. **çº¯å‡½æ•°æµ‹è¯•** - è¾“å…¥è¾“å‡ºæ˜ç¡®
2. **ç±»å‹è½¬æ¢æµ‹è¯•** - camelize, snakelize ç­‰
3. **æ•°æ®éªŒè¯æµ‹è¯•** - Zod schema éªŒè¯
4. **Mock æ¨¡å¼æµ‹è¯•** - å›ºå®šæ¨¡å¼çš„ model æµ‹è¯•

### AI ç”Ÿæˆæµç¨‹

```
1. è¯»å–æºæ–‡ä»¶ï¼Œåˆ†æå¯¼å‡ºå‡½æ•°
2. æå–ç±»å‹ç­¾åå’Œ JSDoc
3. ç”Ÿæˆæµ‹è¯•éª¨æ¶ï¼ˆdescribe/it ç»“æ„ï¼‰
4. å¡«å……æµ‹è¯•ç”¨ä¾‹ï¼š
   - æ­£å¸¸è¾“å…¥
   - è¾¹ç•Œå€¼
   - å¼‚å¸¸è¾“å…¥
   - ç±»å‹é”™è¯¯
5. è¿è¡Œæµ‹è¯•ï¼Œä¿®å¤å¤±è´¥ç”¨ä¾‹
```

### å»ºè®®çš„ Prompt æ¨¡å¼

```
ç»™å®šæºæ–‡ä»¶ {file}ï¼Œç”Ÿæˆå®Œæ•´çš„å•å…ƒæµ‹è¯•ï¼š
1. ä¸ºæ¯ä¸ªå¯¼å‡ºå‡½æ•°åˆ›å»º describe å—
2. è¦†ç›–æ­£å¸¸ç”¨ä¾‹ã€è¾¹ç•Œç”¨ä¾‹ã€å¼‚å¸¸ç”¨ä¾‹
3. ä½¿ç”¨ bun:test æ¡†æ¶
4. Mock å¤–éƒ¨ä¾èµ–
5. ä¿æŒä¸ç°æœ‰æµ‹è¯•é£æ ¼ä¸€è‡´
```

---

## ä¼˜å…ˆçº§æ’åº

| ä¼˜å…ˆçº§ | åŒ… | è¡ŒåŠ¨ |
|--------|---|------|
| ğŸ”´ P0 | platform-helpers | ç«‹å³æ·»åŠ æµ‹è¯• |
| ğŸ”´ P0 | 6 ä¸ªæ— æµ‹è¯•å·¥å…· | AI è‡ªåŠ¨ç”Ÿæˆ |
| ğŸŸ  P1 | memory/* | è¡¥å……æµ‹è¯• |
| ğŸŸ  P1 | Model æµ‹è¯•æ¨¡æ¿ | åˆ›å»ºå¹¶åº”ç”¨ |
| ğŸŸ¡ P2 | ç§»é™¤ coverage.test.ts | ç®€åŒ–ç»“æ„ |
| ğŸŸ¢ P3 | E2E æµ‹è¯•ä¼˜åŒ– | é™ä½è¶…æ—¶ |
