# AFSD (AFS Daemon) è§„æ ¼ v0.1

> çŠ¶æ€: å¾…æ‰§è¡Œ
> ä¼˜å…ˆçº§: é«˜
> ä¾èµ–: AFS repo ç‹¬ç«‹å®Œæˆå

## 1. å®šä½

### AFS çš„æœ¬è´¨

```
AFS ä¸æ˜¯å­˜å‚¨ç³»ç»Ÿï¼Œè€Œæ˜¯ç»Ÿä¸€çš„è®¿é—®æ¥å£å’Œæ§åˆ¶ç³»ç»Ÿã€‚
```

**AFS ä¸æ˜¯**ï¼š
- âŒ å­˜å‚¨ç³»ç»Ÿï¼ˆä¸å­˜æ•°æ®ï¼‰
- âŒ æ–‡ä»¶ç³»ç»Ÿï¼ˆä¸ç®¡ç†æ–‡ä»¶ï¼‰
- âŒ æ•°æ®ä»£ç†ï¼ˆä¸è½¬å‘æ•°æ®ï¼‰
- âŒ æ•°æ®åº“ï¼ˆä¸æŒä¹…åŒ–ä¸šåŠ¡æ•°æ®ï¼‰

**AFS æ˜¯**ï¼š
- âœ… **ç»Ÿä¸€è®¿é—®æ¥å£**ï¼šread/write/exec/explainï¼Œå±è”½åç«¯å·®å¼‚
- âœ… **å‘½åç©ºé—´**ï¼šè·¯å¾„åˆ°èµ„æºçš„æ˜ å°„
- âœ… **æ§åˆ¶å¹³é¢**ï¼šè·¯ç”±ã€æƒé™ã€åè°ƒ
- âœ… **åè®®å±‚**ï¼šå®šä¹‰ Client â†” Provider çš„äº¤äº’æ–¹å¼

**ç±»æ¯”**ï¼š
```
AFS â‰ˆ DNS + API Gateway + Service Mesh
     â†‘         â†‘            â†‘
   å‘½åç©ºé—´  ç»Ÿä¸€æ¥å£    è·¯ç”±æ§åˆ¶
```

### AFSD çš„å®šä½

afsd æ˜¯ AFS çš„ **world hostï¼ˆä¸–ç•Œå®¿ä¸»ï¼‰**ï¼Œæä¾›ç½‘ç»œåŒ–çš„ AFS èƒ½åŠ›ã€‚

**å®ƒä¸æ˜¯**ï¼š
- âŒ ä¸šåŠ¡ç³»ç»Ÿ
- âŒ workflow engine
- âŒ agent orchestrator
- âŒ UI
- âŒ **æ•°æ®å­˜å‚¨/ä»£ç†**ï¼ˆæ•°æ®ç›´æ¥åœ¨ Providerï¼‰

**å®ƒçš„èŒè´£æ˜¯**ï¼š
> ä½œä¸º Router/Coordinatorï¼Œåè°ƒå¤šä¸ª Providerï¼Œæä¾›ç»Ÿä¸€çš„è®¿é—®å…¥å£ã€‚
> æ•°æ®åœ¨ Providerï¼Œæ§åˆ¶åœ¨ AFSDã€‚

---

## 2. æ ¸å¿ƒèŒè´£ï¼ˆMust Haveï¼‰

### 2.1 Path Resolution
- è§£æ AFS è·¯å¾„ï¼ˆå¦‚ `/aine/status`ï¼‰
- æ ¹æ® mount table å†³å®šç”±å“ªä¸ª provider å¤„ç†

### 2.2 Mount Management
- æ”¯æŒ mount / unmount provider
- æ”¯æŒï¼š
  - local provider
  - remote afsdï¼ˆafsd æŒ‚è½½ afsdï¼‰
- mount ä¿¡æ¯æ˜¯æ˜¾å¼ã€å¯ inspect çš„

### 2.3 Operation Dispatch

ç»Ÿä¸€å¤„ç†å¹¶è½¬å‘ä»¥ä¸‹æ“ä½œï¼š
- `read(path)`
- `write(path, content)`
- `exec(path, args)`
- `explain(path or command)`

### 2.4 State Persistence
- AFS artifactsã€metadata å¿…é¡»æŒä¹…åŒ–
- afsd crash / restart åä¸–ç•Œä»ç„¶å­˜åœ¨

### 2.5 Concurrency & Safety
- åŒä¸€è·¯å¾„çš„å¹¶å‘æ“ä½œå¿…é¡»æœ‰æ˜ç¡®ç­–ç•¥ï¼š
  - lock / version / conflict
- å†²çªå¿…é¡»æ˜¾å¼æš´éœ²ï¼Œä¸èƒ½ silently overwrite

---

## 3. æ˜ç¡®ç¦æ­¢ï¼ˆNon-Goalsï¼‰

afsd **ç»å¯¹ä¸å…è®¸**ï¼š
- âŒ è¯­ä¹‰æ¨æ–­ï¼ˆsemantic inferenceï¼‰
- âŒ agent å†³ç­–
- âŒ workflow / pipeline
- âŒ UI / formatting
- âŒ è‡ªåŠ¨ summary
- âŒ éšå¼çŠ¶æ€æˆ– magic behavior

**åˆ¤æ–­æ ‡å‡†**ï¼šå¦‚æœä¸€ä¸ªåŠŸèƒ½å¯ä»¥è¢«æè¿°ä¸º"å¸®ç”¨æˆ· / agent æ›´èªæ˜"â€”â€” é‚£å®ƒ**ä¸å±äº afsd**ã€‚

---

## 4. Protocolï¼ˆæœ€å°ï¼‰

afsd å¯¹å¤–æš´éœ²ä¸€ä¸ªæç®€åè®®ï¼ˆæœ¬åœ°æˆ–è¿œç¨‹ï¼‰ï¼š

```
READ   <path>
WRITE  <path> <content>
EXEC   <path> <args>
EXPLAIN <path|command>
```

**è¿”å›è¦æ±‚**ï¼š
- deterministic
- explainable
- exit code æ˜¯åè®®çš„ä¸€éƒ¨åˆ†

---

## 5. Transport Layerï¼ˆæŠ½è±¡ï¼‰

### è®¾è®¡åŸåˆ™

```
AFSD assumes a secure transport.
Transport is an abstraction â€” implementations are pluggable.
No dynamic control plane is required.
```

### Transport Layer èŒè´£

| åš | ä¸åš |
|----|------|
| æä¾›åŠ å¯†é€šé“ | äº’è”ç½‘çº§ peer discovery |
| é™æ€ peer é…ç½® | NAT ç©¿é€æœåŠ¡ |
| identity anchor (å¦‚ pubkey) | ç½‘ç»œçº§ ACL |
| è¿æ¥å»ºç«‹ | å¤æ‚é‡è¿é€»è¾‘ |
| **æœ¬åœ°ç½‘ç»œè‡ªåŠ¨å‘ç°** | ä¸­å¿ƒåŒ–åè°ƒæœåŠ¡ |

### æœ¬åœ°ç½‘ç»œå‘ç°ï¼ˆLAN Discoveryï¼‰

**ç›®çš„**ï¼šä¾¿äºç”¨æˆ·ç®¡ç†è‡ªå·±çš„è®¾å¤‡ï¼Œè‡ªåŠ¨å‘ç°åŒä¸€ç½‘ç»œå†…çš„ afsd å®ä¾‹ã€‚

**å®ç°æ–¹å¼**ï¼šmDNS / Bonjourï¼ˆæˆç†Ÿã€æ— ä¸­å¿ƒã€é›¶é…ç½®ï¼‰

```
# afsd å¯åŠ¨æ—¶å¹¿æ’­
_afsd._tcp.local.
  name: "robert-macbook"
  port: 7654
  txt: "id=did:abt:xxx" "version=0.1"

# å…¶ä»– afsd è‡ªåŠ¨å‘ç°
$ afs discover
robert-macbook.local:7654  did:abt:xxx
robert-nas.local:7654      did:abt:yyy
```

**è¾¹ç•Œ**ï¼š
- âœ… æœ¬åœ°ç½‘ç»œï¼ˆåŒä¸€ LAN / subnetï¼‰
- âœ… è‡ªå·±çš„è®¾å¤‡
- âŒ è·¨äº’è”ç½‘å‘ç°ï¼ˆéœ€è¦æ˜¾å¼é…ç½®æˆ– WireGuardï¼‰

### æŠ½è±¡æ¥å£

```typescript
interface AFSTransport {
  // å»ºç«‹åˆ° peer çš„è¿æ¥
  connect(peer: PeerConfig): Connection;

  // ä» transport identity æ˜ å°„åˆ° AFS identity
  resolveIdentity(transportId: string): AFSIdentity;
}

interface PeerConfig {
  endpoint: string;           // å¦‚ä½•è¿æ¥
  transportId: string;        // transport å±‚çš„ identity
  afsIdentity?: AFSIdentity;  // æ˜ å°„åˆ° AFS identity
}
```

### å®ç°é€‰é¡¹

| å®ç° | é€‚ç”¨åœºæ™¯ | çŠ¶æ€ |
|------|---------|------|
| **Local IPC** | å•æœºå¤šè¿›ç¨‹ | v0.1 å¿…é¡» |
| **TCP/TLS** | ç®€å•è¿œç¨‹ | v0.1 å¯é€‰ |
| **WireGuard** | å®‰å…¨ç‚¹å¯¹ç‚¹ï¼Œæ— ä¸­å¿ƒä¾èµ– | Roadmap |
| **WebSocket** | Web å®¢æˆ·ç«¯ | Roadmap |

### WireGuard å®ç°è¯´æ˜ï¼ˆRoadmapï¼‰

**å®šä½**ï¼šSecure Transportï¼Œä¸æ˜¯ VPN äº§å“ã€‚

```
WireGuard åè®®    â‰     WireGuard æ§åˆ¶å™¨
é™æ€ peer é…ç½®    â‰     åŠ¨æ€ mesh ç½‘ç»œ
```

**åªç”¨ WireGuard çš„æœ€å°å­é›†**ï¼š
- âœ… åŠ å¯†éš§é“
- âœ… é™æ€ peer å®šä¹‰ï¼ˆæ‰‹å·¥é…ç½®ï¼‰
- âœ… WG pubkey â†’ AFS identity æ˜ å°„
- âŒ åŠ¨æ€ peer discovery
- âŒ NAT æ‰“æ´æœåŠ¡
- âŒ ç½‘ç»œ UI

**é…ç½®ç¤ºä¾‹**ï¼ˆé™æ€æ¨¡å¼ï¼‰ï¼š
```yaml
# afsd transport config
transport:
  type: wireguard
  privateKey: <local-private-key>
  peers:
    - publicKey: <peer-pubkey>
      endpoint: 192.168.1.100:51820
      afsIdentity: did:abt:robert
```

**é˜²å¤±æ§æ£€æµ‹**ï¼ˆä¸€æ—¦å‡ºç°å°±è¶Šç•Œï¼‰ï¼š
- âŒ éœ€è¦"é‡è¿é€»è¾‘"
- âŒ éœ€è¦"peer ç”Ÿå‘½å‘¨æœŸç®¡ç†"
- âŒ éœ€è¦"ç½‘ç»œ UI"

---

## 6. æ¶æ„çº¦æŸ

- afsd å¿…é¡»å…è®¸**å¤šå®ä¾‹**
- **æ²¡æœ‰ä¸­å¿ƒæ§åˆ¶èŠ‚ç‚¹**
- ä¸–ç•Œé€šè¿‡ mount å…³ç³»ç»„åˆï¼Œè€Œä¸æ˜¯ global coordinator

### è¾¹ç¼˜ afsd æ¨¡å¼ï¼ˆEdge Patternï¼‰

**æ ¸å¿ƒåŸåˆ™**ï¼šDriver åœ¨è¾¹ç¼˜å¤„ç†ï¼Œå…¶ä»–è®¾å¤‡åªçœ‹ AFS æŠ½è±¡ã€‚

```
Laptop afsd                   Gateway afsd                  NAS afsd
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /local/*     â”‚             â”‚ /home/*      â”‚            â”‚ /storage/*   â”‚
â”‚ /home/*  â”€â”€â”€â”€â”‚â”€â”€ mount â”€â”€â”€â†’â”‚ â”œâ”€â”€ lights/  â”‚â†zigbee     â”‚ â”œâ”€â”€ photos/  â”‚
â”‚ /nas/*   â”€â”€â”€â”€â”‚â”€â”€ mount â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ â””â”€â”€ videos/  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                             Driver åœ¨è¿™é‡Œ
                             å…¶ä»–è®¾å¤‡ä¸éœ€è¦å…³å¿ƒ
```

**å…¸å‹åœºæ™¯**ï¼š

| è¾¹ç¼˜ afsd | å¤„ç†çš„ driver | æš´éœ²çš„ AFS è·¯å¾„ |
|----------|--------------|----------------|
| Smart Home ç½‘å…³ | Zigbee, HomeKit, Matter | `/home/lights/*`, `/home/sensors/*` |
| NAS | å­˜å‚¨ã€RAIDã€å¤‡ä»½ | `/storage/photos/*`, `/storage/backups/*` |
| åª’ä½“æœåŠ¡å™¨ | è½¬ç ã€æµåª’ä½“ | `/media/movies/*`, `/media/music/*` |
| å¼€å‘æœåŠ¡å™¨ | GPUã€æ¨¡å‹æ¨ç† | `/compute/models/*`, `/compute/jobs/*` |

**ä¼˜åŠ¿**ï¼š
- âœ… æœ¬åœ°è®¾å¤‡ä¸éœ€è¦å®‰è£…å„ç§ driver/SDK
- âœ… ç»Ÿä¸€çš„ AFS è·¯å¾„è®¿é—®æ‰€æœ‰èµ„æº
- âœ… è¾¹ç¼˜è®¾å¤‡ä¸“æ³¨åšå¥½ä¸€ä»¶äº‹
- âœ… é€šè¿‡ mount çµæ´»ç»„åˆ
- âœ… LAN Discovery è‡ªåŠ¨å‘ç°å¯ç”¨çš„è¾¹ç¼˜ afsd

---

## 7. Identityï¼šdid:afs

> è¯¦ç»†è§„æ ¼è§ [did-afs-spec.md](did-afs-spec.md)ï¼ˆç‹¬ç«‹å¼€æº repoï¼‰

### æ ¸å¿ƒå†³ç­–

```
did:afs ä¸ did:abt åœ¨ç»“æ„ä¸Šå‡ ä¹åŒæ„ï¼Œ
ä½†åœ¨"è¯­ä¹‰ä¸»æƒ"å’Œ"ç”Ÿå‘½å‘¨æœŸ"ä¸Šåˆ»æ„åˆ†ç¦»ï¼›
AFS ç”Ÿæ€åŸç”Ÿæ”¯æŒäºŒè€…äº’é€šï¼Œä½†ä¸æ··ç”¨ã€‚
```

### å¿«é€Ÿå¯¹ç…§

| ç»´åº¦ | did:afs | did:abt |
|------|---------|---------|
| **å®šä½** | ä¸–ç•Œå†…åç‰Œ | ä¸–ç•Œå¤–æŠ¤ç…§ |
| **ç”Ÿå‘½å‘¨æœŸ** | ç§’ï½é•¿æœŸ | é•¿æœŸã€ç¨³å®š |
| **ä¸»ä½“** | äºº / agent / device / daemon | äºº / ç»„ç»‡ / è´¦æˆ· |
| **ä¸Šé“¾** | âŒ | âœ… |
| **è§£æ** | AFSD æœ¬åœ° | å…¨å±€ |

### ç¤ºä¾‹

```
did:afs:alice                    # äºº
did:afs:agent/code-reviewer      # AI agent
did:afs:afsd/home-gateway        # daemon
did:afs:device/fridge            # IoT è®¾å¤‡
```

### æ¡¥æ¥ï¼ˆäº’é€šä½†ä¸æ··ç”¨ï¼‰

```
did:afs:alice
  â””â”€â”€ alsoKnownAs: did:abt:z8ia...
```

ACL æ°¸è¿œåªçœ‹ did:afsï¼š
```
âœ… ALLOW did:afs:alice EXEC /team/deploy
âŒ ALLOW did:abt:... EXEC /team/deploy
```

---

## 8. æˆåŠŸæ ‡å‡†

> ç”¨æˆ·å‡ ä¹æ„Ÿè§‰ä¸åˆ°å®ƒçš„å­˜åœ¨ï¼Œä½†æ‰€æœ‰ä¸–ç•ŒçŠ¶æ€éƒ½ç¦»ä¸å¼€å®ƒã€‚

---

## 9. äº§å“æ¶æ„ï¼šAFSD ä¸ AINE çš„å…³ç³»

> å†³ç­–æ—¥æœŸ: 2026-01-16
> çŠ¶æ€: å·²å†³å®š

### æ ¸å¿ƒåŸåˆ™

```
AFSD æ˜¯å†…æ ¸ï¼ŒAINE æ˜¯äº§å“
ç”¨æˆ·è£…ä¸€ä¸ª Appï¼Œå†…éƒ¨æ˜¯ä¸¤å±‚æ¶æ„
```

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AINE (é¢å‘ç”¨æˆ·çš„äº§å“)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AINE Desktop (GUI å…¥å£ï¼Œç³»ç»Ÿæ‰˜ç›˜å¸¸é©»)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                               â”‚
â”‚                         â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AINE Runtime                                     â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Blocklet å…¼å®¹å±‚ (è¿è¡Œæ—§ blocklet)            â”‚  â”‚
â”‚  â”‚  â””â”€â”€ AIGNE Observe (å¯è§‚æµ‹æ€§æ¨¡å—)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                               â”‚
â”‚                         â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AFSD (æ ¸å¿ƒ daemonï¼Œé•¿æœŸé©»ç•™)                     â”‚  â”‚
â”‚  â”‚  â””â”€â”€ ä¸–ç•Œå®¿ä¸»ï¼Œæ‰€æœ‰çŠ¶æ€çš„ source of truth         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶å®šä½

| ç»„ä»¶ | å®šä½ | é•¿æœŸé©»ç•™ | ç”¨æˆ·å¯è§ |
|------|------|---------|---------|
| **AFSD** | æ ¸å¿ƒ daemonï¼Œä¸–ç•Œå®¿ä¸» | âœ… å¿…é¡» | âŒ é€æ˜ |
| **AINE Runtime** | åº”ç”¨å±‚ï¼Œå« Blocklet å…¼å®¹ | âœ… éš AFSD | âŒ é€æ˜ |
| **AINE Desktop** | GUI å£³ï¼Œç®¡ç†ä¸€åˆ‡ | âœ… ç³»ç»Ÿæ‰˜ç›˜ | âœ… ä¸»å…¥å£ |
| **AIGNE Observe** | AINE çš„åŠŸèƒ½æ¨¡å— | æŒ‰éœ€å¯åŠ¨ | é€šè¿‡ AINE |
| **Blocklet Server** | âŒ è¢« AINE å–ä»£ | â€” | â€” |

### æˆ˜ç•¥å†³ç­–

1. **Blocklet æ˜¯å†å²äº§ç‰©** â€” åªåšå…¼å®¹ï¼Œä¸å†ç‹¬ç«‹å‘å±•
2. **AINE å–ä»£ Blocklet** â€” AINE ç›®æ ‡æ˜¯èƒ½è¿è¡Œ Blocklet
3. **ç”¨æˆ·åªè£…ä¸€ä¸ªä¸œè¥¿** â€” AINE Desktopï¼ˆå†…å« AFSDï¼‰

### ç”¨æˆ·ä½“éªŒ

**GUI ç”¨æˆ·**:
```
å®‰è£… AINE Desktop
â””â”€â”€ è‡ªåŠ¨åŒ…å« afsd
â””â”€â”€ ç³»ç»Ÿæ‰˜ç›˜å¸¸é©»
â””â”€â”€ ä¸€é”®ç®¡ç†æ‰€æœ‰æœåŠ¡
```

**CLI/Server ç”¨æˆ·**:
```bash
brew install aine-cli  # åŒ…å« afsd
aine start             # å¯åŠ¨ afsd + aine runtime
```

### ç±»æ¯”

```
AINE Desktop : AFSD = Docker Desktop : Docker Daemon
```

- AFSD æ˜¯æ— å¤´çš„æ ¸å¿ƒå¼•æ“
- AINE Desktop æ˜¯é¢å‘ç”¨æˆ·çš„ GUI å£³
- ä¸¤è€…å¯ä»¥åˆ†ç¦»éƒ¨ç½²ï¼ˆheadless åœºæ™¯ï¼‰

### å®ç°ç­–ç•¥

> AINE Desktop å·²å­˜åœ¨ï¼ŒAFSD æ— éœ€å®ç°ä»»ä½• UI

| ç»„ä»¶ | UI èŒè´£ |
|------|--------|
| **AFSD** | âŒ æ—  UIï¼Œçº¯ daemon |
| **AINE Desktop** | âœ… æä¾› AFSD ç®¡ç†é¢æ¿ |

**AFSD åªæš´éœ²**:
- IPC/HTTP APIï¼ˆä¾› AINE Desktop è°ƒç”¨ï¼‰
- CLI å‘½ä»¤ï¼ˆä¾›è„šæœ¬/è°ƒè¯•ä½¿ç”¨ï¼‰

**AINE Desktop è´Ÿè´£**:
- AFSD çŠ¶æ€å±•ç¤º
- Mount ç®¡ç†ç•Œé¢
- æœåŠ¡å¯åœæ§åˆ¶
- æ—¥å¿—æŸ¥çœ‹

---

## å¼€æºä¸å•†ä¸šç‰ˆæœ¬ç•Œé™

**å†…æ ¸ä¸€è‡´ï¼Œèƒ½åŠ›åˆ†å±‚**ï¼š

| afsd (å¼€æº reference) | AFS Runtime (å•†ä¸šç‰ˆ) |
|----------------------|---------------------|
| æ ¸å¿ƒåè®®å®ç° | é«˜æ€§èƒ½ä¼˜åŒ– |
| åŸºæœ¬ persistence | ä¼ä¸šçº§å­˜å‚¨ |
| åŸºæœ¬ concurrency | åˆ†å¸ƒå¼ä¸€è‡´æ€§ |
| å•å®ä¾‹è¿è¡Œ | æ°´å¹³æ‰©å±• / é«˜å¯ç”¨ |
| æ— æƒé™ç®¡ç† | æƒé™ç®¡ç† / ACL |
| æ— å®¡è®¡ | Auditing / åˆè§„ |
| ç‹¬ç«‹è¿è¡Œ | DID é›†æˆ / èº«ä»½éªŒè¯ |

**åŸåˆ™**ï¼š
- å¼€æºç‰ˆï¼šä»»ä½•äººå¯ä»¥è·‘è‡ªå·±éœ€è¦çš„
- å•†ä¸šç‰ˆï¼šé«˜æ€§èƒ½ã€æƒé™ç®¡ç†ã€auditingã€DID é›†æˆ
- **å†…æ ¸å’Œå¼€æºæ˜¯ä¸€æ ·çš„**

---

## 10. åè®®é€‰æ‹©åˆ†æ

> å†³ç­–æ—¥æœŸ: 2026-01-17
> çŠ¶æ€: å·²å†³å®š

### æ ¸å¿ƒå®šä½

```
AFSD æ˜¯ç½‘ç»œæœåŠ¡å™¨ + mount routerï¼Œä¸æ˜¯ AFS provider çš„å®¿ä¸»ã€‚
Provider é€šè¿‡åè®®æŒ‚è½½åˆ° AFSDï¼Œå¯ä»¥æ˜¯ä»»æ„è¯­è¨€å®ç°ã€‚
Client â†” AFSD â†” Provider ä½¿ç”¨ç»Ÿä¸€åè®®ã€‚
```

### å…³é”®æ´å¯Ÿï¼šAFS ä¸æ˜¯ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿ

```
AFS èµ„æºèƒŒåå¯èƒ½æ˜¯ï¼š
- æ–‡ä»¶ï¼ˆæ¯«ç§’å“åº”ï¼‰
- Agentï¼ˆç§’çº§å“åº”ï¼Œstreaming outputï¼‰
- è®¾å¤‡ï¼ˆä¸ç¡®å®šå»¶è¿Ÿï¼‰
- äººï¼ˆHuman in the loopï¼Œåˆ†é’Ÿåˆ°å°æ—¶çº§ï¼‰

è¿™ç§"ä¸ç¡®å®šå»¶è¿Ÿ"æ¨¡å‹ï¼Œä¼ ç»Ÿ request-response åè®®æ— æ³•ä¼˜é›…å¤„ç†ã€‚
```

### å€™é€‰åè®®è¯„ä¼°

| åè®® | ä¼˜åŠ¿ | AFS é€‚åˆåº¦ | é—®é¢˜ |
|-----|------|-----------|------|
| **9P** | ä½ overheadï¼Œæ–‡ä»¶ç³»ç»ŸåŸç”Ÿ | âŒ ä¸é€‚åˆ | exec/streaming ä¸æ˜¯ä¸€ç­‰å…¬æ°‘ |
| **gRPC** | å·¥å…·é“¾æˆç†Ÿï¼Œstreaming æ”¯æŒ | âš ï¸ éƒ¨åˆ†é€‚åˆ | æµè§ˆå™¨éœ€è¦ gRPC-Web ä»£ç† |
| **WebSocket + Event** | åŒå‘é€šä¿¡ï¼ŒWeb åŸç”Ÿ | âœ… é€‚åˆ | éœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯æ ¼å¼ |
| **NFS** | æˆç†Ÿ | âŒ ä¸é€‚åˆ | å¤ªé‡ï¼Œä¸æ”¯æŒ exec |

### ä¸ºä»€ä¹ˆä¸é€‰æ‹© 9P

è™½ç„¶ 9P åè®®ç®€æ´ä¼˜é›…ï¼ˆ7 bytes overheadï¼‰ï¼Œæœ€åˆçœ‹èµ·æ¥å¾ˆé€‚åˆ AFSï¼Œä½†æ·±å…¥åˆ†æåå‘ç°æœ¬è´¨å·®å¼‚ï¼š

**1. æ“ä½œæ¨¡å‹ä¸åŒ¹é…**

| ç»´åº¦ | 9P | AFS |
|-----|-----|-----|
| æ ¸å¿ƒæŠ½è±¡ | æ–‡ä»¶æ˜¯ byte stream | èµ„æºå¯ä»¥æ˜¯æ–‡ä»¶/æœåŠ¡/agent/äºº |
| æ“ä½œæ¨¡å‹ | open â†’ read/write â†’ close | read/write/**exec**/explain |
| é€šä¿¡æ¨¡å¼ | request-response (pull) | éœ€è¦ push/streaming |
| å»¶è¿Ÿå‡è®¾ | æ¯«ç§’çº§ | æ¯«ç§’åˆ°å°æ—¶ï¼ˆä¸ç¡®å®šï¼‰ |

**2. exec ä¸æ˜¯ä¸€ç­‰å…¬æ°‘**

9P çš„ exec éœ€è¦æ¨¡æ‹Ÿï¼šwrite args â†’ continuous read output
- æ— æ³•è¡¨è¾¾ "æ‰§è¡Œä¸­"ã€"ç­‰å¾…äººç±»å“åº”"ç­‰çŠ¶æ€
- Streaming output æ˜¯ pull-basedï¼Œä¸æ˜¯ push-based
- éœ€è¦å¤§é‡è‡ªå®šä¹‰æ‰©å±•ï¼ˆTexec, Tstreamï¼‰ï¼Œå¤±å»æ ‡å‡†åŒ–ä¼˜åŠ¿

**3. v9fs æ— æ³•ä½¿ç”¨æ‰©å±•**

å¦‚æœå¤§é‡ä½¿ç”¨è‡ªå®šä¹‰æ‰©å±•ï¼ˆ9P2000.afsï¼‰ï¼Œv9fs å†…æ ¸é©±åŠ¨æ— æ³•è¯†åˆ«ï¼š
- åªæœ‰æ ‡å‡† read/write å¯ä»¥é€šè¿‡ v9fs
- exec/explain å¿…é¡»ç”¨ä¸“ç”¨ client
- å¤±å»äº†é€‰æ‹© 9P çš„ä¸»è¦ä¼˜åŠ¿

**4. Human in the loop åœºæ™¯**

AFS çš„ exec å¯èƒ½è§¦å‘éœ€è¦äººç±»å‚ä¸çš„æµç¨‹ï¼š
- 9P æ˜¯åŒæ­¥åè®®ï¼Œæ— æ³•ä¼˜é›…å¤„ç†"ç­‰å¾…æ•°å°æ—¶"çš„åœºæ™¯
- éœ€è¦ ticket/callback æœºåˆ¶ï¼Œ9P ä¸åŸç”Ÿæ”¯æŒ

**5. Web åœºæ™¯ä¸å‹å¥½**

- 9P æ˜¯äºŒè¿›åˆ¶åè®®ï¼Œæµè§ˆå™¨ä¸èƒ½ç›´æ¥ä½¿ç”¨
- æ²¡æœ‰æˆç†Ÿçš„ 9P-over-WebSocket å®ç°
- éœ€è¦é¢å¤–çš„ HTTP gateway

**ç»“è®º**ï¼š9P é€‚åˆä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œä½† AFS çš„ exec/explain/human-in-the-loop è¯­ä¹‰éœ€è¦ä¸åŒçš„åè®®æ¨¡å‹ã€‚

### å†³ç­–ï¼šEvent Sourcing + WebSocket

é€‰æ‹© **Event Sourcing** ä½œä¸ºæ ¸å¿ƒæ¨¡å‹ï¼Œ**WebSocket** ä½œä¸ºä¼ è¾“å±‚ã€‚

**ä¸ºä»€ä¹ˆæ˜¯ Event Sourcing**ï¼š

```
AFS æœ¬è´¨ä¸Šæ˜¯ append-mostly çš„ event logã€‚
æ‰€æœ‰æ“ä½œï¼ˆread/write/exec/explainï¼‰éƒ½æ˜¯ eventã€‚
ç»“æœé€šè¿‡åç»­ event è¿”å›ã€‚
```

- âœ… å¤©ç„¶æ”¯æŒä¸ç¡®å®šå»¶è¿Ÿï¼ˆevent å¯ä»¥å¾ˆä¹…æ‰åˆ°ï¼‰
- âœ… ç»Ÿä¸€æ¨¡å‹ï¼ˆæ‰€æœ‰æ“ä½œéƒ½æ˜¯ eventï¼‰
- âœ… æ”¯æŒ Human in the loopï¼ˆexec event â†’ ç­‰å¾… â†’ result eventï¼‰
- âœ… ä¸ Team AFS çš„ append-mostly æ¨¡å‹ä¸€è‡´
- âœ… å¯å®¡è®¡ï¼ˆæ‰€æœ‰ event éƒ½æœ‰è®°å½•ï¼‰

**ä¸ºä»€ä¹ˆæ˜¯ WebSocket**ï¼š

- âœ… æµè§ˆå™¨åŸç”Ÿæ”¯æŒ
- âœ… åŒå‘é€šä¿¡ï¼ˆserver å¯ä»¥ push eventï¼‰
- âœ… é•¿è¿æ¥ï¼ˆé€‚åˆè®¢é˜… event streamï¼‰
- âœ… è·¨å¹³å°ï¼ˆNative/Web/Mobile éƒ½æ”¯æŒï¼‰

### AFS åè®®è®¾è®¡

**Event ç±»å‹**ï¼š

```
# è¯·æ±‚ Eventï¼ˆClient â†’ AFSDï¼‰
ReadRequest   { path, options }
WriteRequest  { path, data, options }
ExecRequest   { path, args, options }
ExplainRequest { query }
Subscribe     { path_pattern }
Unsubscribe   { subscription_id }

# å“åº” Eventï¼ˆAFSD â†’ Clientï¼‰
ReadResult    { request_id, data, status }
WriteResult   { request_id, status }
ExecStarted   { request_id, exec_id }
ExecOutput    { exec_id, chunk, is_final }
ExecResult    { exec_id, result, status }
ExplainResult { request_id, explanation }
Error         { request_id, code, message }
```

**Exec æµç¨‹ç¤ºä¾‹**ï¼š

```
Client                          AFSD                         Provider/Agent/Human
   â”‚                              â”‚                              â”‚
   â”‚  ExecRequest(path, args)     â”‚                              â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                              â”‚
   â”‚                              â”‚  dispatch to provider        â”‚
   â”‚                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚  ExecStarted(exec_id)        â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                              â”‚                              â”‚ (processing...)
   â”‚                              â”‚  ExecOutput(chunk)           â”‚
   â”‚  ExecOutput(exec_id, chunk)  â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                              â”‚                              â”‚ (more processing...)
   â”‚  ExecOutput(exec_id, chunk)  â”‚  ExecOutput(chunk)           â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                              â”‚                              â”‚
   â”‚                              â”‚  ExecResult(result)          â”‚
   â”‚  ExecResult(exec_id, result) â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
```

**Human in the loop ç¤ºä¾‹**ï¼š

```
Client                          AFSD                         Human (via another client)
   â”‚                              â”‚                              â”‚
   â”‚  ExecRequest(/approval/doc)  â”‚                              â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                              â”‚
   â”‚  ExecStarted(exec_id)        â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                              â”‚  (ç­‰å¾…äººç±»å®¡æ‰¹...)            â”‚
   â”‚                              â”‚                              â”‚
   â”‚  ExecOutput("waiting for     â”‚                              â”‚
   â”‚   approval from @alice")     â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                              â”‚                              â”‚
   â”‚          ... 2 hours later ...                              â”‚
   â”‚                              â”‚                              â”‚
   â”‚                              â”‚            Alice approves    â”‚
   â”‚                              â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚  ExecResult(approved)        â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
```

### æ¶ˆæ¯æ ¼å¼

**æ¨èï¼šJSONï¼ˆå¼€å‘é˜¶æ®µï¼‰â†’ Protobufï¼ˆç”Ÿäº§ä¼˜åŒ–ï¼‰**

```json
{
  "type": "ExecRequest",
  "id": "req-123",
  "timestamp": "2026-01-17T10:00:00Z",
  "identity": "did:afs:alice",
  "payload": {
    "path": "/agent/code-review",
    "args": { "file": "main.go" }
  }
}
```

**ä¸ºä»€ä¹ˆå…ˆ JSON**ï¼š
- è°ƒè¯•å‹å¥½
- å¿«é€Ÿè¿­ä»£
- æµè§ˆå™¨ devtools å¯ç›´æ¥æŸ¥çœ‹

**åç»­å¯åˆ‡æ¢ Protobuf**ï¼š
- æ›´å°çš„ payload
- Schema å¼ºåˆ¶
- è·¨è¯­è¨€ç”Ÿæˆ

### Mount æ–¹å‘ï¼šå¤–éƒ¨èµ„æºå¼•å…¥ AFS

**é‡è¦æ¾„æ¸…**ï¼šAFS ä¸æ˜¯è¦æš´éœ²ç»™ OS çš„æ–‡ä»¶ç³»ç»Ÿã€‚Mount çš„æ–¹å‘æ˜¯æŠŠå¤–éƒ¨èµ„æº**å¼•å…¥** AFS worldã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AFS World (é€»è¾‘å‘½åç©ºé—´)                                â”‚
â”‚                                                         â”‚
â”‚  /local/*    â† mount â† æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ (fs API)            â”‚
â”‚  /history/*  â† mount â† SQLite å­˜å‚¨                      â”‚
â”‚  /agent/*    â† mount â† AI Agent è¿›ç¨‹                    â”‚
â”‚  /remote/*   â† mount â† å¦ä¸€ä¸ª afsd                      â”‚
â”‚  /device/*   â† mount â† IoT è®¾å¤‡                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸éœ€è¦ FUSE**ï¼š
- âŒ ä¸æ˜¯æŠŠ AFS æš´éœ²æˆ /mnt/afs
- âœ… æ˜¯æŠŠå¤–éƒ¨èµ„æºé€šè¿‡ provider å¼•å…¥ AFS å‘½åç©ºé—´

### AFS vs AFSDï¼šäº§å“åˆ†å±‚

```
AFS æ˜¯å¼€æºæ ¸å¿ƒï¼Œåº”ç”¨å¯ä»¥ç›´æ¥ç”¨ã€‚
AFSD æ˜¯å¢å€¼å±‚ï¼Œæä¾›ç½‘ç»œåŒ–ã€è®¤è¯ã€å¼‚æ­¥èƒ½åŠ›ã€‚
```

**äº§å“è¾¹ç•Œä¸å•†ä¸šæ¨¡å¼**ï¼š

| å±‚ | å®šä½ | èƒ½åŠ› | å¼€æº/å•†ä¸š |
|---|------|------|----------|
| **AFS** | æ ¸å¿ƒåº“ | å‘½åç©ºé—´ã€Provider æ¥å£ã€åŒæ­¥ mount | âœ… å¼€æº |
| **AFSD** | æœåŠ¡å±‚ | ç½‘ç»œäº’è”ã€è®¤è¯ã€å¼‚æ­¥ execã€æŒä¹…åŒ– | ğŸ’° å•†ä¸š |
| **AFS åº”ç”¨** | åŸºäº AFS çš„ä¸¥è‚ƒæœåŠ¡ | Team AFSã€ä¼ä¸šæœåŠ¡ç­‰ | ğŸ’° å•†ä¸š |

**å•†ä¸šé€»è¾‘**ï¼š
```
AFS å¼€æº â†’ å»ºç«‹ç”Ÿæ€ï¼Œä»»ä½•åº”ç”¨å¯ç”¨
AFSD å•†ä¸š â†’ ç½‘ç»œåŒ–ã€è®¤è¯ã€å¼‚æ­¥æ˜¯å¢å€¼èƒ½åŠ›
AFS åº”ç”¨å•†ä¸š â†’ åŸºäº AFS æ„å»ºçš„å®Œæ•´äº§å“
```

**ç±»æ¯”**ï¼š
- AFS â‰ˆ Linux kernelï¼ˆå¼€æºï¼‰
- AFSD â‰ˆ Red Hat Enterprise Linuxï¼ˆå•†ä¸šæ”¯æŒï¼‰
- AFS åº”ç”¨ â‰ˆ åŸºäº Linux çš„ SaaS äº§å“

**AFSï¼ˆå¼€æºæ ¸å¿ƒï¼‰æä¾›**ï¼š
- å‘½åç©ºé—´æŠ½è±¡ï¼ˆè·¯å¾„ã€mountï¼‰
- Provider æ¥å£ï¼ˆread/write/exec/explainï¼‰
- åº”ç”¨å†… mountï¼ˆä»£ç ç›´æ¥ç”¨ï¼‰
- åŒæ­¥æ“ä½œæ¨¡å‹

**AFSDï¼ˆå¢å€¼å±‚ï¼‰é¢å¤–æä¾›**ï¼š
- ğŸŒ **æœåŠ¡ç½‘ç»œ**ï¼šå¤šèŠ‚ç‚¹äº’è”ï¼Œafsd å¯ä»¥ mount å¦ä¸€ä¸ª afsd
- ğŸ” **è®¤è¯**ï¼šdid:afs èº«ä»½éªŒè¯
- ğŸ“¦ **æŒä¹…åŒ–**ï¼šmount é…ç½®ã€event log æŒä¹…åŒ–
- â³ **å¼‚æ­¥å¤„ç†**ï¼šexec å¯ä»¥æ˜¯ Agentã€è®¾å¤‡ã€ç”šè‡³äººï¼ˆHuman in the loopï¼‰
- ğŸ“¡ **Event sourcing**ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯ eventï¼Œå¯å®¡è®¡ã€å¯å›æ”¾

### ä¸¤ç§ä½¿ç”¨æ¨¡å¼

**æ¨¡å¼ 1ï¼šåº”ç”¨å†… AFSï¼ˆä¸éœ€è¦ afsdï¼‰**

```typescript
// åº”ç”¨ç›´æ¥åˆ›å»º AFS å®ä¾‹
const afs = new AFS();
afs.mount('/local', new LocalFS({ path: '/home/user/docs' }));
afs.mount('/history', new AFSHistory({ storage: 'sqlite:./history.db' }));

// åŒæ­¥æ“ä½œ
const content = await afs.read('/local/readme.md');
await afs.write('/history/log.txt', 'hello');
```

é€‚ç”¨åœºæ™¯ï¼šå•åº”ç”¨ã€æœ¬åœ°ä½¿ç”¨ã€ä¸éœ€è¦ç½‘ç»œ/è®¤è¯/å¼‚æ­¥

**æ¨¡å¼ 2ï¼šé€šè¿‡ AFSDï¼ˆç½‘ç»œåŒ–æœåŠ¡ï¼‰**

```typescript
// è¿æ¥åˆ° afsd
const client = new AFSClient('ws://localhost:7654');

// afsd æä¾›ï¼š
// - æŒä¹…åŒ– mount é…ç½®
// - did:afs è®¤è¯
// - å¤š client å…±äº«åŒä¸€ä¸ª world
// - å¼‚æ­¥ execï¼ˆå¯èƒ½ç­‰å¾…å¾ˆä¹…ï¼‰

const execId = await client.exec('/agent/review', { code: '...' });
client.on('ExecOutput', (event) => {
  if (event.execId === execId) {
    console.log(event.chunk);  // streaming output
  }
});
```

é€‚ç”¨åœºæ™¯ï¼šå¤š client å…±äº«ã€éœ€è¦è®¤è¯ã€éœ€è¦å¼‚æ­¥ execï¼ˆAgent/Humanï¼‰

### AFSD æ˜¯ Routerï¼Œä¸æ˜¯ Proxy

**æ ¸å¿ƒåŸåˆ™**ï¼š

```
AFSD æ˜¯è·¯ç”±å™¨ï¼Œä¸æ˜¯æ•°æ®ä»£ç†ã€‚
å°½é‡ç›´è¿ Providerï¼Œé¿å…æ•°æ®ç»è¿‡ AFSDã€‚
ä»»ä½•è½¬å‘éƒ½ç‰ºç‰²æ€§èƒ½ã€‚
```

**ä¼ ç»Ÿ Proxy æ¨¡å¼ï¼ˆä¸é‡‡ç”¨ï¼‰**ï¼š
```
Client â†’ AFSD â†’ Provider â†’ AFSD â†’ Client
              â†‘ æ•°æ®ç“¶é¢ˆï¼Œå»¶è¿Ÿç¿»å€
```

**Router æ¨¡å¼ï¼ˆé‡‡ç”¨ï¼‰**ï¼š
```
Client â†’ AFSD: "æˆ‘è¦ /remote/file.txt"
Client â† AFSD: "ç›´æ¥å» afsd-b:7654"
Client â†â†’ afsd-b: ç›´æ¥é€šä¿¡
```

**æ··åˆæ¨¡å¼ + è‡ªåŠ¨é™çº§**ï¼š

| æƒ…å†µ | è¡Œä¸º |
|-----|------|
| Provider å¯ç›´è¿ | è¿”å›åœ°å€ï¼ŒClient ç›´è¿ |
| ç½‘ç»œä¸é€š | è‡ªåŠ¨é™çº§åˆ° AFSD proxy |
| é˜²ç«å¢™/NAT | AFSD ä½œä¸ºä¸­ç»§ |

**exec ä¹Ÿæ˜¯ç›´è¿**ï¼š

exec æœ¬è´¨æ˜¯ RPCï¼Œæœ€ç»ˆç”±èƒ½åŠ›æä¾›è€…æ‰§è¡Œï¼š
```
Client â†’ AFSD: ExecRequest(/agent/review, args)
Client â† AFSD: ExecRouted(provider: "agent-server:8080", exec_id)
Client â†’ agent-server: ç›´æ¥ execï¼Œæ¥æ”¶ streaming output
```

**å¯¹ Client é€æ˜**ï¼š

Client SDK è‡ªåŠ¨å¤„ç†è·¯ç”±å’Œé™çº§ï¼Œä¸Šå±‚åº”ç”¨æ— æ„ŸçŸ¥ï¼š
```typescript
// åº”ç”¨ä»£ç ä¸éœ€è¦å…³å¿ƒæ˜¯ç›´è¿è¿˜æ˜¯ proxy
const result = await client.read('/remote/file.txt');
const execId = await client.exec('/agent/review', { code });
```

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AFSD - Router / Coordinatorï¼ˆä¸æ˜¯ Data Proxyï¼‰                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Mount Table                                              â”‚ â”‚
â”‚  â”‚  /local/*   â†’ provider-a (æœ¬åœ°)                           â”‚ â”‚
â”‚  â”‚  /remote/*  â†’ afsd-b:7654 (å¯ç›´è¿)                        â”‚ â”‚
â”‚  â”‚  /agent/*   â†’ agent-server:8080 (å¯ç›´è¿)                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Route Resolver                                           â”‚ â”‚
â”‚  â”‚  - è§£æè·¯å¾„ â†’ è¿”å› Provider åœ°å€                          â”‚ â”‚
â”‚  â”‚  - æ£€æµ‹ç›´è¿å¯è¡Œæ€§                                          â”‚ â”‚
â”‚  â”‚  - ä¸å¯ç›´è¿æ—¶é™çº§ä¸º proxy                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Event Log (å¯é€‰ï¼Œç”¨äºå®¡è®¡)                               â”‚ â”‚
â”‚  â”‚  - è®°å½•è·¯ç”±å†³ç­–                                           â”‚ â”‚
â”‚  â”‚  - ä¸è®°å½•å®é™…æ•°æ®ï¼ˆé™¤é proxy æ¨¡å¼ï¼‰                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ è·¯ç”±ä¿¡æ¯                    â”‚ é™çº§æ—¶ proxy
         â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  ç›´è¿  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  ç›´è¿  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client     â”‚â†â”€â”€â”€â”€â”€â”€â†’â”‚ Provider A  â”‚        â”‚ Provider B     â”‚
â”‚             â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ (afsd-b)       â”‚
â”‚             â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Agent Server â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è·¯ç”±åè®®æ‰©å±•

**æ–°å¢ Event ç±»å‹**ï¼š

```typescript
// AFSD è¿”å›è·¯ç”±ä¿¡æ¯
interface RouteResponse {
  type: 'RouteResponse';
  request_id: string;
  route: {
    direct: boolean;           // æ˜¯å¦å¯ç›´è¿
    endpoint?: string;         // Provider åœ°å€ï¼ˆç›´è¿æ—¶ï¼‰
    path?: string;             // Provider å†…éƒ¨è·¯å¾„
    fallback?: 'proxy';        // é™çº§ç­–ç•¥
  };
}

// Client è¯·æ±‚è·¯ç”±ï¼ˆå¯é€‰ï¼ŒSDK è‡ªåŠ¨å¤„ç†ï¼‰
interface RouteRequest {
  type: 'RouteRequest';
  path: string;
}
```

**ç›´è¿æµç¨‹**ï¼š

```
1. Client â†’ AFSD: ReadRequest(/remote/data.txt)
2. AFSD æ£€æµ‹ /remote/* æ˜ å°„åˆ° afsd-b:7654
3. AFSD æ£€æµ‹ afsd-b å¯ç›´è¿
4. AFSD â†’ Client: RouteResponse(direct: true, endpoint: "afsd-b:7654", path: "/data.txt")
5. Client SDK è‡ªåŠ¨è¿æ¥ afsd-b
6. Client â† afsd-b: ReadResult(data)
```

**é™çº§æµç¨‹**ï¼š

```
1. Client â†’ AFSD: ReadRequest(/remote/data.txt)
2. AFSD æ£€æµ‹ afsd-b ä¸å¯ç›´è¿ï¼ˆNAT/é˜²ç«å¢™ï¼‰
3. AFSD â†’ Client: RouteResponse(direct: false, fallback: "proxy")
4. AFSD ä½œä¸º proxy è½¬å‘è¯·æ±‚
5. Client â† AFSD: ReadResult(data)
```

### åº”ç”¨å†… AFSï¼ˆä¸éœ€è¦ afsdï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨å†… AFS (æ— éœ€ afsdï¼Œæ— éœ€ç½‘ç»œ)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  const afs = new AFS();                                   â”‚ â”‚
â”‚  â”‚  afs.mount('/local', new LocalFS(...));                   â”‚ â”‚
â”‚  â”‚  afs.mount('/history', new AFSHistory(...));              â”‚ â”‚
â”‚  â”‚  // Provider ç›´æ¥åœ¨è¿›ç¨‹å†…ï¼Œæ— éœ€è·¯ç”±                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Web åœºæ™¯

**æµè§ˆå™¨ç›´è¿ AFSD**ï¼š

```javascript
const ws = new WebSocket('wss://afsd.local:7654');

// è®¢é˜… event
ws.send(JSON.stringify({
  type: 'Subscribe',
  payload: { path_pattern: '/team/**' }
}));

// å‘é€ exec è¯·æ±‚
ws.send(JSON.stringify({
  type: 'ExecRequest',
  id: 'req-1',
  payload: { path: '/agent/summarize', args: { doc: '/team/docs/plan.md' } }
}));

// æ¥æ”¶ event stream
ws.onmessage = (e) => {
  const event = JSON.parse(e.data);
  if (event.type === 'ExecOutput') {
    console.log('Output:', event.payload.chunk);
  }
};
```

### åè®®å¯¹æ¯”æ€»ç»“

| ç»´åº¦ | 9P | Event Sourcing + WebSocket |
|-----|-----|---------------------------|
| exec æ”¯æŒ | éœ€è¦æ‰©å±•ï¼Œä¸ä¼˜é›… | âœ… åŸç”Ÿæ”¯æŒ |
| streaming | pull-based | âœ… push-based |
| human in loop | âŒ ä¸æ”¯æŒ | âœ… åŸç”Ÿæ”¯æŒ |
| Web æ”¯æŒ | éœ€è¦ gateway | âœ… ç›´è¿ |
| ä¸ç¡®å®šå»¶è¿Ÿ | âŒ åŒæ­¥æ¨¡å‹ | âœ… å¼‚æ­¥ event |
| overhead | æœ€ä½ (7 bytes) | ä¸­ç­‰ (JSON) / ä½ (protobuf) |
| è°ƒè¯• | å›°éš¾ï¼ˆäºŒè¿›åˆ¶ï¼‰ | âœ… ç®€å•ï¼ˆJSON å¯è¯»ï¼‰ |
| å¯¹ç­‰èŠ‚ç‚¹ | éœ€è¦ä¸­å¿ƒ server | âœ… ä»»æ„èŠ‚ç‚¹å¯äº’è” |

---

## 11. è¯­è¨€é€‰æ‹©ä¸å®ç°ç­–ç•¥

> å†³ç­–æ—¥æœŸ: 2026-01-17
> çŠ¶æ€: å·²å†³å®š

### åŒç‰ˆæœ¬ç­–ç•¥

```
TypeScript ç‰ˆï¼ˆå‚è€ƒå®ç°ï¼Œé•¿æœŸç»´æŠ¤ï¼‰
    â†“ ç¨³å®šå
Go ç‰ˆï¼ˆç”Ÿäº§ä¼˜åŒ–ç‰ˆï¼‰
```

| ç‰ˆæœ¬ | å®šä½ | è¿è¡Œæ—¶ | çŠ¶æ€ |
|-----|------|-------|------|
| **afsd (TS)** | å‚è€ƒå®ç° | Bun | é•¿æœŸç»´æŠ¤ |
| **afsd (Go)** | ç”Ÿäº§ä¼˜åŒ– | åŸç”ŸäºŒè¿›åˆ¶ | ç¨³å®šåå¼€å‘ |

### ä¸ºä»€ä¹ˆå…ˆ TypeScript

- âœ… å¼€å‘é€Ÿåº¦å¿«ï¼Œå¿«é€ŸéªŒè¯è®¾è®¡
- âœ… å’Œç°æœ‰ AFS ä»£ç ï¼ˆTSï¼‰åŒè¯­è¨€ï¼Œå¯å¤ç”¨
- âœ… Bun åŸç”Ÿ WebSocket æ”¯æŒï¼Œæ€§èƒ½ä¸é”™
- âœ… Web client å¯ä»¥å…±äº«ä»£ç 
- âœ… é¿å…åˆæœŸåœ¨ä¸¤å¥—è¯­è¨€é—´æŠ˜è…¾

### ä¸ºä»€ä¹ˆæœ€ç»ˆéœ€è¦ Go ç‰ˆ

- âœ… å•äºŒè¿›åˆ¶éƒ¨ç½²ï¼ˆè¾¹ç¼˜è®¾å¤‡ï¼‰
- âœ… goroutine å¤„ç†å¤§é‡å¹¶å‘è¿æ¥
- âœ… æ›´ä½çš„å†…å­˜å ç”¨
- âœ… æ›´å¥½çš„ mDNS/ç³»ç»Ÿé›†æˆ

### è¯­è¨€å¯¹æ¯”

| è€ƒé‡ | TypeScript (Bun) | Go |
|-----|-----------------|-----|
| å¼€å‘é€Ÿåº¦ | âœ… å¿« | ä¸­ |
| ä¸ AFS å¤ç”¨ | âœ… åŒè¯­è¨€ | éœ€è¦é‡å†™ |
| WebSocket | âœ… Bun åŸç”Ÿ | âœ… gorilla/websocket |
| å•äºŒè¿›åˆ¶ | âŒ éœ€è¦ Bun | âœ… |
| å†…å­˜å ç”¨ | ä¸­ | âœ… ä½ |
| è¾¹ç¼˜éƒ¨ç½² | å¯ä»¥ï¼ˆBunï¼‰ | âœ… æ›´ä¼˜ |

### ä»£ç ä»“åº“

```
ç‹¬ç«‹ repo: afsd
â”œâ”€â”€ src/           # TypeScript å®ç°
â”œâ”€â”€ web/           # Web client SDK
â””â”€â”€ go/            # Go å®ç°ï¼ˆç¨³å®šåï¼‰
```

### Provider ä¸ AFSD çš„å…³ç³»

```
Provider (ä»»æ„è¯­è¨€)  â†â”€â”€ WebSocket + Event â”€â”€â†’  AFSD (Go)
```

- ç°æœ‰ TS afs provider ä½œä¸ºç‹¬ç«‹è¿›ç¨‹è¿è¡Œ
- é€šè¿‡ WebSocket è¿æ¥åˆ° AFSDï¼Œæ¥æ”¶/å‘é€ Event
- AFSD ä¸å…³å¿ƒ provider å®ç°è¯­è¨€
- ç»Ÿä¸€åè®®ï¼šClient â†” AFSD â†” Provider éƒ½ç”¨ç›¸åŒçš„ Event æ ¼å¼

---

## å®ç°è®¡åˆ’

### ç›®å½•ç»“æ„ï¼ˆTypeScript ç‰ˆï¼‰
```
afsd/                       # ç‹¬ç«‹ repo
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts            # å…¥å£
â”‚   â”œâ”€â”€ server/
â”‚   â”‚   â”œâ”€â”€ websocket.ts    # WebSocket æœåŠ¡å™¨ (Bun åŸç”Ÿ)
â”‚   â”‚   â””â”€â”€ handler.ts      # Event å¤„ç†
â”‚   â”œâ”€â”€ event/
â”‚   â”‚   â”œâ”€â”€ types.ts        # Event ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ log.ts          # Event Log (append-only)
â”‚   â”‚   â””â”€â”€ dispatch.ts     # Event åˆ†å‘
â”‚   â”œâ”€â”€ mount/
â”‚   â”‚   â”œâ”€â”€ table.ts        # mount table
â”‚   â”‚   â””â”€â”€ router.ts       # è·¯å¾„è·¯ç”±
â”‚   â”œâ”€â”€ exec/
â”‚   â”‚   â”œâ”€â”€ manager.ts      # Exec ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â”‚   â””â”€â”€ stream.ts       # Output streaming
â”‚   â”œâ”€â”€ provider/
â”‚   â”‚   â”œâ”€â”€ interface.ts    # Provider æ¥å£
â”‚   â”‚   â”œâ”€â”€ memory.ts       # å†…ç½® MemoryProvider
â”‚   â”‚   â””â”€â”€ connector.ts    # å¤–éƒ¨ Provider è¿æ¥å™¨
â”‚   â””â”€â”€ storage/
â”‚       â”œâ”€â”€ interface.ts    # å­˜å‚¨æ¥å£ï¼ˆå¯æ’æ‹”ï¼‰
â”‚       â”œâ”€â”€ memory.ts       # å†…å­˜å­˜å‚¨
â”‚       â””â”€â”€ sqlite.ts       # SQLite å­˜å‚¨
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ index.ts            # Client SDK
â”‚   â””â”€â”€ browser.ts          # æµè§ˆå™¨ä¸“ç”¨
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ simple-server.ts    # æœ€ç®€å•çš„ server ç¤ºä¾‹
â”‚   â”œâ”€â”€ echo-provider.ts    # Echo Provider ç¤ºä¾‹
â”‚   â””â”€â”€ web-client.html     # æµè§ˆå™¨ client ç¤ºä¾‹
â”œâ”€â”€ test/
â””â”€â”€ package.json
```

### è¡ŒåŠ¨é¡¹

**Phase 1: æœ€å° PoCï¼ˆéªŒè¯æ¶æ„ï¼‰**ï¼š
- [ ] åˆ›å»º afsd repoï¼Œåˆå§‹åŒ– Bun é¡¹ç›®
- [ ] å®šä¹‰ Event ç±»å‹ï¼ˆTypeScript types + JSON schemaï¼‰
- [ ] å®ç° WebSocket serverï¼ˆBun åŸç”Ÿ WebSocketï¼‰
- [ ] å®ç°å†…ç½® MemoryProviderï¼ˆread/writeï¼‰
- [ ] å®ç° mount table + path routing
- [ ] å®ç° ExecRequest/ExecStarted/ExecOutput/ExecResult æµç¨‹
- [ ] åˆ›å»ºæµè§ˆå™¨ client ç¤ºä¾‹ï¼ˆéªŒè¯ Web ç›´è¿ï¼‰
- [ ] å•å…ƒæµ‹è¯•

**Phase 2: Provider åè®®**ï¼š
- [ ] å®ç°å¤–éƒ¨ Provider è¿æ¥åè®®
- [ ] åˆ›å»º Echo Provider ç¤ºä¾‹ï¼ˆéªŒè¯è·¨è¿›ç¨‹é€šä¿¡ï¼‰
- [ ] å®ç° Provider ä¸»åŠ¨è¿æ¥æ¨¡å¼
- [ ] å®ç° AFSD å¯åŠ¨ Provider æ¨¡å¼
- [ ] å®ç° Exec streamingï¼ˆProvider â†’ AFSD â†’ Clientï¼‰
- [ ] é›†æˆæµ‹è¯•ï¼šå¤–éƒ¨ Provider exec + streaming

**Phase 3: æŒä¹…åŒ– & ç¨³å®š**ï¼š
- [ ] å®ç°å¯æ’æ‹”å­˜å‚¨æ¥å£
- [ ] å®ç° SQLite å­˜å‚¨åç«¯
- [ ] å®ç° Event Log æŒä¹…åŒ–
- [ ] å®ç° Mount Table æŒä¹…åŒ–
- [ ] crash recovery æµ‹è¯•
- [ ] å‘å¸ƒ npm åŒ…ï¼ˆ@aigne/afsdï¼‰

**Phase 4: ç”Ÿäº§ç‰¹æ€§**ï¼š
- [ ] å®ç° did:afs identity éªŒè¯
- [ ] å®ç° Subscribe/Unsubscribeï¼ˆevent è®¢é˜…ï¼‰
- [ ] å®ç° LAN Discoveryï¼ˆmDNS/Bonjourï¼‰
- [ ] Human in the loop æ”¯æŒ
- [ ] TLS æ”¯æŒï¼ˆwss://ï¼‰
- [ ] æ€§èƒ½æµ‹è¯• & ä¼˜åŒ–

**Go ç‰ˆ Roadmapï¼ˆTS ç‰ˆç¨³å®šåï¼‰**ï¼š
- [ ] Go ç‰ˆ AFSD å®ç°
- [ ] å•äºŒè¿›åˆ¶éƒ¨ç½²
- [ ] æ›´ä½å†…å­˜å ç”¨ä¼˜åŒ–
- [ ] è¾¹ç¼˜è®¾å¤‡æ”¯æŒ

---

## 12. Messaging ä½“ç³»ï¼šå¼‚æ­¥é€šçŸ¥ä¸çŠ¶æ€æŸ¥è¯¢

> å†³ç­–æ—¥æœŸ: 2026-01-17
> çŠ¶æ€: è®¾è®¡ä¸­

### æ ¸å¿ƒé—®é¢˜

```
AFS æœ¬è´¨ä¸Šæ˜¯å¼‚æ­¥çš„ã€‚
ä¸€ä¸ª read å¯èƒ½ pending å¾ˆä¹…ï¼ˆç­‰å¾… Agent å¤„ç†ã€ç­‰å¾…äººç±»å®¡æ‰¹ï¼‰ã€‚
Client éœ€è¦çŸ¥é“ï¼šä»€ä¹ˆæ—¶å€™å¯ä»¥è¯»äº†ï¼Ÿæ“ä½œå¤±è´¥äº†å—ï¼Ÿ
```

### è®¾è®¡åŸåˆ™

```
1. Push ä¸ºä¸»ï¼šçŠ¶æ€å˜åŒ–æ—¶ä¸»åŠ¨é€šçŸ¥ Client
2. Pull å…œåº•ï¼šClient å¯ä»¥ä¸»åŠ¨æŸ¥è¯¢çŠ¶æ€ï¼ˆå¤„ç†é€šçŸ¥ä¸¢å¤±ï¼‰
3. ç»Ÿä¸€æ¨¡å‹ï¼šé€šçŸ¥æœ¬èº«ä¹Ÿæ˜¯ Eventï¼Œå¤ç”¨ Event Sourcing æ¶æ„
4. å¹‚ç­‰æŸ¥è¯¢ï¼šé‡å¤æŸ¥è¯¢ä¸äº§ç”Ÿå‰¯ä½œç”¨
```

### æ“ä½œç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ“ä½œç”Ÿå‘½å‘¨æœŸ                                                â”‚
â”‚                                                             â”‚
â”‚  pending â”€â”€â†’ processing â”€â”€â†’ ready â”€â”€â†’ (consumed)           â”‚
â”‚     â”‚            â”‚            â”‚                             â”‚
â”‚     â”‚            â”‚            â””â”€â”€ Client å·²è¯»å–ç»“æœ          â”‚
â”‚     â”‚            â””â”€â”€ æ­£åœ¨å¤„ç†ä¸­                              â”‚
â”‚     â””â”€â”€ å·²æ¥æ”¶è¯·æ±‚ï¼Œç­‰å¾…å¤„ç†                                  â”‚
â”‚                                                             â”‚
â”‚  ä»»ä½•é˜¶æ®µéƒ½å¯èƒ½ â†’ failed                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event ç±»å‹æ‰©å±•

**çŠ¶æ€é€šçŸ¥ Eventï¼ˆAFSD â†’ Clientï¼‰**ï¼š

```typescript
// æ“ä½œçŠ¶æ€å˜åŒ–é€šçŸ¥
interface StatusChanged {
  type: 'StatusChanged';
  request_id: string;           // åŸå§‹è¯·æ±‚ ID
  operation: 'read' | 'write' | 'exec' | 'explain';
  path: string;
  status: 'pending' | 'processing' | 'ready' | 'failed' | 'expired';
  timestamp: string;
  detail?: {
    progress?: number;          // 0-100ï¼Œå¦‚æœå¯ä»¥ä¼°ç®—
    message?: string;           // äººç±»å¯è¯»çŠ¶æ€
    eta?: string;               // é¢„è®¡å®Œæˆæ—¶é—´ï¼ˆå¦‚æœå¯ä¼°ç®—ï¼‰
    error?: {                   // failed æ—¶çš„é”™è¯¯ä¿¡æ¯
      code: string;
      message: string;
    };
  };
}

// æ“ä½œç»“æœå°±ç»ªé€šçŸ¥ï¼ˆready çŠ¶æ€çš„è¯¦ç»†ç‰ˆæœ¬ï¼‰
interface ResultReady {
  type: 'ResultReady';
  request_id: string;
  operation: 'read' | 'write' | 'exec' | 'explain';
  path: string;
  timestamp: string;
  ttl?: number;                 // ç»“æœä¿ç•™æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¿‡æœŸåéœ€è¦é‡æ–°è¯·æ±‚
}
```

**çŠ¶æ€æŸ¥è¯¢ Eventï¼ˆClient â†’ AFSDï¼‰**ï¼š

```typescript
// æŸ¥è¯¢å•ä¸ªæ“ä½œçŠ¶æ€
interface StatusQuery {
  type: 'StatusQuery';
  request_id: string;
}

// æŸ¥è¯¢è·¯å¾„ç›¸å…³çš„æ‰€æœ‰ pending æ“ä½œ
interface PendingQuery {
  type: 'PendingQuery';
  path_pattern: string;         // æ”¯æŒ globï¼Œå¦‚ /team/**
}

// æŸ¥è¯¢å“åº”
interface StatusQueryResult {
  type: 'StatusQueryResult';
  query_id: string;
  operations: Array<{
    request_id: string;
    operation: 'read' | 'write' | 'exec' | 'explain';
    path: string;
    status: 'pending' | 'processing' | 'ready' | 'failed' | 'expired';
    created_at: string;
    updated_at: string;
    detail?: { /* same as StatusChanged.detail */ };
  }>;
}
```

### è®¢é˜…æœºåˆ¶

**è®¢é˜…çŠ¶æ€å˜åŒ–**ï¼š

```typescript
// è®¢é˜…ç‰¹å®šè·¯å¾„çš„çŠ¶æ€å˜åŒ–
interface SubscribeStatus {
  type: 'SubscribeStatus';
  subscription_id: string;
  path_pattern: string;         // /team/**, /agent/*
  operations?: ('read' | 'write' | 'exec' | 'explain')[];  // å¯é€‰è¿‡æ»¤
  statuses?: ('pending' | 'processing' | 'ready' | 'failed')[];  // å¯é€‰è¿‡æ»¤
}

// å–æ¶ˆè®¢é˜…
interface UnsubscribeStatus {
  type: 'UnsubscribeStatus';
  subscription_id: string;
}
```

### å¯é æ€§æœºåˆ¶

**1. é‡è¿æ—¶åŒæ­¥**

```
Client æ–­çº¿é‡è¿åï¼š
1. å‘é€ PendingQuery è·å–æ‰€æœ‰ pending æ“ä½œ
2. æ£€æŸ¥æ˜¯å¦æœ‰é”™è¿‡çš„ ready/failed çŠ¶æ€
3. é‡æ–°è®¢é˜…å…³æ³¨çš„è·¯å¾„
```

**2. Request ID å¹‚ç­‰**

```
åŒä¸€ä¸ª request_id çš„æ“ä½œåªæ‰§è¡Œä¸€æ¬¡ã€‚
Client å¯ä»¥å®‰å…¨åœ°é‡å‘è¯·æ±‚ï¼ˆå¦‚æœä¸ç¡®å®šæ˜¯å¦å·²æ”¶åˆ°ï¼‰ã€‚
```

**3. ç»“æœç¼“å­˜**

```
ready çŠ¶æ€çš„ç»“æœä¼šç¼“å­˜ä¸€æ®µæ—¶é—´ï¼ˆç”± ttl æ§åˆ¶ï¼‰ã€‚
Client é”™è¿‡é€šçŸ¥åï¼Œä»å¯æŸ¥è¯¢å¹¶è·å–ç»“æœã€‚
ttl è¿‡æœŸåï¼ŒçŠ¶æ€å˜ä¸º expiredï¼Œéœ€è¦é‡æ–°è¯·æ±‚ã€‚
```

**4. Heartbeat ä¸ Presence**

```typescript
// Client å®šæœŸå‘é€å¿ƒè·³
interface Heartbeat {
  type: 'Heartbeat';
  client_id: string;
  timestamp: string;
}

// AFSD å“åº”å¿ƒè·³
interface HeartbeatAck {
  type: 'HeartbeatAck';
  timestamp: string;
  server_time: string;
}
```

### å…¸å‹æµç¨‹

**åœºæ™¯ 1ï¼šRead éœ€è¦ Agent å¤„ç†**

```
Client                          AFSD                         Agent
   â”‚                              â”‚                              â”‚
   â”‚  ReadRequest(/report/daily)  â”‚                              â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                              â”‚
   â”‚                              â”‚  å‘ç°éœ€è¦ Agent ç”Ÿæˆ          â”‚
   â”‚                              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚  StatusChanged(pending)      â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                              â”‚                              â”‚
   â”‚      ... Client å¯ä»¥åšå…¶ä»–äº‹ ...                              â”‚
   â”‚                              â”‚                              â”‚
   â”‚  StatusChanged(processing)   â”‚   Agent å¼€å§‹å¤„ç†             â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                              â”‚                              â”‚
   â”‚  StatusChanged(ready)        â”‚   Agent å®Œæˆ                 â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                              â”‚                              â”‚
   â”‚  ReadRequest(/report/daily)  â”‚   Client å†æ¬¡ read           â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                              â”‚
   â”‚  ReadResult(data)            â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
```

**åœºæ™¯ 2ï¼šClient é”™è¿‡é€šçŸ¥**

```
Client                          AFSD
   â”‚                              â”‚
   â”‚  ReadRequest(/report/daily)  â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚  StatusChanged(pending)      â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                              â”‚
   â”‚    ... Client æ–­çº¿ ...        â”‚
   â”‚                              â”‚
   â”‚  StatusChanged(ready)        â”‚  âœ— Client æ²¡æ”¶åˆ°
   â”‚â†â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”‚
   â”‚                              â”‚
   â”‚    ... Client é‡è¿ ...        â”‚
   â”‚                              â”‚
   â”‚  PendingQuery(/report/*)     â”‚  æŸ¥è¯¢æ‰€æœ‰ç›¸å…³æ“ä½œ
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚  StatusQueryResult           â”‚  å‘ç° ready çŠ¶æ€
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                              â”‚
   â”‚  ReadRequest(/report/daily)  â”‚  è·å–ç»“æœ
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚  ReadResult(data)            â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

**åœºæ™¯ 3ï¼šHuman in the loop**

```
Client                          AFSD                         Human (@alice)
   â”‚                              â”‚                              â”‚
   â”‚  ExecRequest(/approval/doc)  â”‚                              â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                              â”‚
   â”‚  ExecStarted(exec_id)        â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                              â”‚                              â”‚
   â”‚  StatusChanged(pending,      â”‚   é€šçŸ¥éœ€è¦ Alice å®¡æ‰¹        â”‚
   â”‚    message: "waiting for     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚    @alice approval")         â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                              â”‚                              â”‚
   â”‚      ... 2 å°æ—¶å ...                                        â”‚
   â”‚                              â”‚                              â”‚
   â”‚  StatusQuery(exec_id)        â”‚   Client ä¸»åŠ¨æŸ¥è¯¢çŠ¶æ€         â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                              â”‚
   â”‚  StatusQueryResult(pending)  â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                              â”‚                              â”‚
   â”‚      ... åˆè¿‡äº† 1 å°æ—¶ ...                                    â”‚
   â”‚                              â”‚                              â”‚
   â”‚                              â”‚   Alice ç‚¹å‡» approve         â”‚
   â”‚                              â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚  StatusChanged(ready)        â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚  ExecResult(approved)        â”‚                              â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
```

### è®¾è®¡å†³ç­–

**ä¸ºä»€ä¹ˆä¸ç”¨ Message Queue**ï¼š

```
âŒ å¼•å…¥ Kafka/RabbitMQ ç­‰å¢åŠ å¤æ‚æ€§
âŒ éœ€è¦é¢å¤–éƒ¨ç½²å’Œç»´æŠ¤
âœ… WebSocket + Event å·²ç»æä¾›åŒå‘é€šä¿¡
âœ… AFSD æœ¬èº«å°±æ˜¯ Event Logï¼Œè‡ªå¸¦æŒä¹…åŒ–
```

**ä¸ºä»€ä¹ˆä¸ç”¨ Polling**ï¼š

```
âŒ æµªè´¹å¸¦å®½ï¼ˆå¤§é‡æ— æ•ˆè¯·æ±‚ï¼‰
âŒ å»¶è¿Ÿé«˜ï¼ˆè½®è¯¢é—´éš”ï¼‰
âœ… Push é€šçŸ¥å³æ—¶æ€§å¥½
âœ… Pull åªä½œä¸ºå…œåº•æœºåˆ¶
```

**ç»“æœç¼“å­˜ç­–ç•¥**ï¼š

```
- ready ç»“æœé»˜è®¤ç¼“å­˜ 1 å°æ—¶
- å¤§ç»“æœï¼ˆ>1MBï¼‰ç¼“å­˜æ—¶é—´æ›´çŸ­
- expired åéœ€è¦é‡æ–°æ‰§è¡Œæ“ä½œ
- è¿™æ˜¯åˆç†çš„ï¼šé¿å… AFSD æ— é™ç§¯ç´¯å†å²ç»“æœ
```

---

## 13. Cache ç­–ç•¥ï¼šå…¨è‡ªåŠ¨ã€é›¶é…ç½®

> å†³ç­–æ—¥æœŸ: 2026-01-17
> çŠ¶æ€: å·²å†³å®š

### æ ¸å¿ƒåŸåˆ™

```
Cache æ˜¯å®ç°ç»†èŠ‚ï¼Œä¸æ˜¯åŠŸèƒ½ã€‚
ç”¨æˆ·ä¸éœ€è¦çŸ¥é“ cache å­˜åœ¨ï¼Œä¹Ÿä¸éœ€è¦é…ç½®ä»»ä½•ä¸œè¥¿ã€‚
```

### è®¾è®¡å†³ç­–

**é€‰æ‹©ï¼šAFSD å…¨è‡ªåŠ¨ cache**

| ç»´åº¦ | å†³ç­– |
|------|------|
| é»˜è®¤çŠ¶æ€ | å¼€å¯ |
| ç”¨æˆ·é…ç½® | æ— ï¼ˆé›¶é…ç½®ï¼‰ |
| å¤±æ•ˆç­–ç•¥ | è‡ªåŠ¨ï¼ˆwrite è§¦å‘ï¼‰ |
| TTL | Provider hint æˆ–é»˜è®¤çŸ­ TTL |

### å®ç°æœºåˆ¶

**1. Provider å¯æŒ‡å®š cache hint**

```typescript
interface ReadResult {
  type: 'ReadResult';
  request_id: string;
  data: any;
  cache_hint?: {
    ttl?: number;           // å»ºè®®ç¼“å­˜æ—¶é•¿ï¼ˆç§’ï¼‰
    revalidate?: boolean;   // æ˜¯å¦å…è®¸ç¼“å­˜ï¼Œé»˜è®¤ true
  };
}
```

**2. é»˜è®¤è¡Œä¸º**

```
æœ‰ cache_hint.ttl    â†’ æŒ‰ Provider å»ºè®®
æœ‰ cache_hint.revalidate: false â†’ ä¸ç¼“å­˜
æ²¡æœ‰ hint           â†’ çŸ­ TTLï¼ˆ10sï¼‰
write åŒè·¯å¾„        â†’ ç«‹å³å¤±æ•ˆ
```

**3. è‡ªåŠ¨å¤±æ•ˆ**

```
WriteResult æˆåŠŸå â†’ å¤±æ•ˆè¯¥ path çš„ cache
DataChanged æ”¶åˆ°å â†’ å¤±æ•ˆè¯¥ path çš„ cache
```

### ä¸ºä»€ä¹ˆé›¶é…ç½®

```
âŒ é…ç½® = ç”¨æˆ·å¿ƒæ™ºè´Ÿæ‹…
âŒ "è¿™ä¸ªè·¯å¾„è¦ä¸è¦ç¼“å­˜ï¼ŸTTL å¤šå°‘ï¼Ÿ" ä¸åº”è¯¥æ˜¯ç”¨æˆ·çš„é—®é¢˜
âœ… AFSD è‡ªåŠ¨å¤„ç†ï¼ŒProvider çŸ¥é“è‡ªå·±æ•°æ®çš„ç‰¹æ€§
âœ… ç”¨æˆ·ä»£ç ä¸å˜ï¼Œæ€§èƒ½è‡ªåŠ¨ä¼˜åŒ–
```

### ç‰¹æ®Šè·¯å¾„å¤„ç†

| è·¯å¾„æ¨¡å¼ | Cache è¡Œä¸º |
|---------|-----------|
| `/agent/**` | é»˜è®¤ä¸ç¼“å­˜ï¼ˆexec ç»“æœä¸å¯å¤ç”¨ï¼‰ |
| å…¶ä»– read | æŒ‰ Provider hint æˆ–çŸ­ TTL |
| write/exec | ä¸ç¼“å­˜ |

### å†…å­˜ç®¡ç†

```
- LRU ç­–ç•¥
- é»˜è®¤ä¸Šé™ï¼šå¯ç”¨å†…å­˜çš„ 10% æˆ– 100MBï¼ˆå–å°ï¼‰
- è¶…é™æ—¶è‡ªåŠ¨æ·˜æ±°æœ€ä¹…æœªç”¨
- è¿™äº›éƒ½æ˜¯å®ç°ç»†èŠ‚ï¼Œä¸æš´éœ²ç»™ç”¨æˆ·
```

---

## 14. åœºæ™¯éªŒè¯ï¼šS3 ç½‘ç›˜

> éªŒè¯ AFS/AFSD æ¶æ„æ˜¯å¦èƒ½æ”¯æ’‘å…¸å‹åº”ç”¨

### åœºæ™¯æè¿°

```
ç”¨ S3 ä½œä¸ºå­˜å‚¨åç«¯ï¼Œé€šè¿‡ AFS æä¾›ç½‘ç›˜åŠŸèƒ½ã€‚
éªŒè¯ AFS ä½œä¸º "Control Surface" çš„å®šä½ã€‚
```

### åŠŸèƒ½æ˜ å°„

| ç½‘ç›˜åŠŸèƒ½ | AFS æ“ä½œ | S3 æ˜ å°„ |
|---------|---------|--------|
| ä¸Šä¼ æ–‡ä»¶ | `write(/files/doc.pdf, data)` | PutObject |
| ä¸‹è½½æ–‡ä»¶ | `read(/files/doc.pdf)` | GetObject |
| ç›®å½•æµè§ˆ | `list(/files/)` | ListObjects |
| åˆ é™¤æ–‡ä»¶ | `exec(/files/doc.pdf, {action: 'delete'})` | DeleteObject |
| é‡å‘½å | `exec(/files/doc.pdf, {action: 'rename', to: 'new.pdf'})` | CopyObject + Delete |
| åˆ†äº« | `exec(/files/doc.pdf, {action: 'share', ttl: 3600})` | Presigned URL |
| å¤šè®¾å¤‡åŒæ­¥ | `Subscribe` + `DataChanged` | S3 Events |
| ç‰ˆæœ¬å†å² | `list(/files/doc.pdf, {versions: true})` | S3 Versioning |

### å¤§æ–‡ä»¶å¤„ç†

```
AFSD æ˜¯ Routerï¼Œä¸æ˜¯ Proxyã€‚
å¤§æ–‡ä»¶ç›´è¿ S3ï¼Œä¸ç»è¿‡ AFSDã€‚
Streaming/åˆ†ç‰‡æ˜¯ S3 â†” Client çš„äº‹ï¼Œä¸ AFS æ— å…³ã€‚
```

**æµç¨‹ç¤ºä¾‹**ï¼š
```
Client â†’ AFSD: write(/files/big.zip, {size: 2GB})
Client â† AFSD: RouteResponse(direct: true, endpoint: "s3://bucket/...")
Client â†” S3: multipart uploadï¼ˆAFSD ä¸ç»æ‰‹æ•°æ®ï¼‰
Client â†’ AFSD: WriteComplete(/files/big.zip)  # é€šçŸ¥å®Œæˆ
AFSD â†’ *: DataChanged(/files/big.zip)  # å¹¿æ’­ç»™å…¶ä»– Client
```

### Metadataï¼šç»™ LLM çš„è¯´æ˜ä¹¦

AFS metadata è¿œè¶…ä¼ ç»Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œä¸º Agent æä¾›ä¸°å¯Œä¸Šä¸‹æ–‡ï¼š

```yaml
# /files/quarterly-report.xlsx çš„ metadata
path: /files/quarterly-report.xlsx
type: spreadsheet
mime: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
size: 2.3MB
created: 2026-01-15
modified: 2026-01-17

# LLM éœ€è¦çš„"è¯´æ˜ä¹¦"
description: "Q4 2025 è´¢åŠ¡æŠ¥å‘Šï¼ŒåŒ…å«æ”¶å…¥ã€æ”¯å‡ºã€åˆ©æ¶¦åˆ†æ"
schema:
  sheets:
    - name: "æ”¶å…¥"
      columns: [æœˆä»½, äº§å“çº¿, é‡‘é¢]
    - name: "æ”¯å‡º"
      columns: [æœˆä»½, ç±»åˆ«, é‡‘é¢]
operations:
  - read: "è·å–å®Œæ•´å†…å®¹"
  - exec/summarize: "ç”Ÿæˆæ‘˜è¦"
  - exec/query: "ç”¨è‡ªç„¶è¯­è¨€æŸ¥è¯¢æ•°æ®"
tags: [è´¢åŠ¡, Q4, 2025]
```

### éªŒè¯ç»“è®º

```
âœ… S3 ç½‘ç›˜åœºæ™¯å®Œå…¨å¯è¡Œ
âœ… AFS åŸºæœ¬æ“ä½œï¼ˆread/write/list/execï¼‰è¦†ç›–æ‰€æœ‰åŠŸèƒ½
âœ… Router æ¨¡å¼é¿å…å¤§æ–‡ä»¶ç“¶é¢ˆ
âœ… Metadata ä¸º Agent æä¾›ä¸°å¯Œä¸Šä¸‹æ–‡
âœ… æ— éœ€ä¿®æ”¹ AFSD æ ¸å¿ƒè®¾è®¡
```

---

## 15. åœºæ™¯éªŒè¯ï¼šSmart Home è®¾å¤‡ç®¡ç†

> ç±»ä¼¼ SNMPï¼Œç”¨ AFS ç®¡ç†å®¶åº­ç½‘ç»œå’Œæ™ºèƒ½è®¾å¤‡

### åœºæ™¯æè¿°

```
ç”¨ AFS ç»Ÿä¸€ç®¡ç† Smart Home è®¾å¤‡ã€‚
ç½‘å…³ï¼ˆHomeAssistant/Zigbee Hub/Matterï¼‰ä½œä¸º Provider mount åˆ° AFSã€‚
Agent é€šè¿‡ exec å®ç°è‡ªåŠ¨åŒ–ã€‚
```

### åŠŸèƒ½æ˜ å°„

| åŠŸèƒ½ | ä¼ ç»Ÿæ–¹å¼ | AFS æ˜ å°„ |
|-----|---------|---------|
| è¯»è®¾å¤‡çŠ¶æ€ | SNMP GET | `read(/home/lights/living-room)` |
| æ§åˆ¶è®¾å¤‡ | å„ç§åè®® | `exec(/home/lights/living-room, {action: 'on', brightness: 80})` |
| æ‰¹é‡æŸ¥è¯¢ | SNMP GETBULK | `list(/home/devices/)` |
| è®¾å¤‡äº‹ä»¶ | SNMP TRAP | `Subscribe(/home/**)` + `DataChanged` |
| è‡ªåŠ¨åŒ– | è§„åˆ™å¼•æ“ | Agent exec AFS é‡Œçš„ tool |

### æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è®¾å¤‡ / Agent                                            â”‚
â”‚  read/write/exec/list â†’ AFS è·¯å¾„                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AFSD (Router)                                              â”‚
â”‚  /home/* â†’ Gateway afsd                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway afsd (è¾¹ç¼˜èŠ‚ç‚¹ï¼Œè¿è¡Œåœ¨å®¶åº­ç½‘å…³ä¸Š)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Zigbee Provider    â†’ /home/lights/*, /home/sensors/*   â”‚â”‚
â”‚  â”‚  HomeKit Provider   â†’ /home/homekit/*                   â”‚â”‚
â”‚  â”‚  Matter Provider    â†’ /home/matter/*                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  è®¾å¤‡å‘ç°ã€åè®®è½¬æ¢éƒ½æ˜¯ç½‘å…³ Provider çš„äº‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰©ç†è®¾å¤‡                                                    â”‚
â”‚  ç¯ã€ä¼ æ„Ÿå™¨ã€é—¨é”ã€æ‘„åƒå¤´...                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Metadata ç¤ºä¾‹

```yaml
# /home/lights/living-room çš„ metadata
path: /home/lights/living-room
type: device
device_type: light
protocol: zigbee
manufacturer: Philips
model: Hue White
capabilities:
  - on_off
  - brightness
  - color_temperature
state:
  power: on
  brightness: 80
  color_temp: 4000K
operations:
  - exec/on: "å¼€ç¯"
  - exec/off: "å…³ç¯"
  - exec/set: "è®¾ç½®äº®åº¦/è‰²æ¸©ï¼Œå‚æ•°: {brightness: 0-100, color_temp: 2700-6500}"
```

### è‡ªåŠ¨åŒ–ç¤ºä¾‹

```
Agent è®¢é˜… /home/sensors/motionï¼Œå½“æ£€æµ‹åˆ°åŠ¨ä½œæ—¶ exec /home/lights/living-room

è¿™æ˜¯ Agent çš„é€»è¾‘ï¼Œä¸æ˜¯ AFSD çš„åŠŸèƒ½ã€‚
AFSD åªæä¾› Subscribe + exec èƒ½åŠ›ã€‚
```

### è¾¹ç•Œåˆ’åˆ†

| èŒè´£ | è´Ÿè´£æ–¹ |
|-----|-------|
| è®¾å¤‡å‘ç° | ç½‘å…³ Provider |
| åè®®è½¬æ¢ | ç½‘å…³ Provider |
| å»¶è¿Ÿä¼˜åŒ– | ç½‘å…³ Providerï¼ˆæœ¬åœ°å¤„ç†ï¼‰ |
| ç¦»çº¿å·¥ä½œ | ç½‘å…³ afsdï¼ˆç‹¬ç«‹è¿è¡Œï¼‰ |
| è‡ªåŠ¨åŒ–è§„åˆ™ | Agentï¼ˆexec toolï¼‰ |
| è·¯ç”±åè°ƒ | AFSD |

### éªŒè¯ç»“è®º

```
âœ… Smart Home åœºæ™¯å®Œå…¨å¯è¡Œ
âœ… ç½‘å…³ä½œä¸º Provider mountï¼ŒAFSD ä¸å…³å¿ƒåº•å±‚åè®®
âœ… è®¾å¤‡å‘ç°/ç®¡ç†æ˜¯ç½‘å…³çš„äº‹
âœ… è‡ªåŠ¨åŒ–æ˜¯ Agent exec çš„ç»“æœ
âœ… æ— éœ€ä¿®æ”¹ AFSD æ ¸å¿ƒè®¾è®¡
```

---

## 16. åœºæ™¯éªŒè¯ï¼šTeam AFSï¼ˆå›¢é˜Ÿåä½œç³»ç»Ÿï¼‰

> è®ºå›ã€æ¶ˆæ¯ã€ä»»åŠ¡ç®¡ç†ã€æˆå‘˜ç®¡ç†çš„å†…éƒ¨åŠå…¬åä½œç³»ç»Ÿ
> è¯¦ç»†æ„¿æ™¯è§ [team-afs-vision.md](team-afs-vision.md)

### åœºæ™¯æè¿°

```
ç”¨ AFS æ„å»ºå›¢é˜Ÿå†…éƒ¨åä½œç³»ç»Ÿã€‚
äººå’Œ AI å…±åŒå†™å…¥ï¼ŒAI è‡ªåŠ¨å¤„ç†ç”ŸæˆæŠ¥å‘Šå’Œè§†å›¾ã€‚
æ‰€æœ‰äº§ç‰©ï¼ˆåŒ…æ‹¬è¡ç”Ÿæ•°æ®ï¼‰éƒ½åœ¨ AFS é‡Œã€‚
```

### åŠŸèƒ½æ˜ å°„

| åŠŸèƒ½ | AFS æ“ä½œ |
|-----|---------|
| **è®ºå›/è®¨è®º** | |
| å‘å¸– | `write(/team/discussions/2026-01-17-cli-design.md)` |
| è¯»å¸– | `read(/team/discussions/...)` |
| åˆ—è¡¨ | `list(/team/discussions/)` |
| **æ¶ˆæ¯** | |
| å‘æ¶ˆæ¯ | `write(/team/messages/alice/2026-01-17-001.md)` |
| å®æ—¶é€šçŸ¥ | `Subscribe(/team/messages/alice/**)` + `DataChanged` |
| **ä»»åŠ¡ç®¡ç†** | |
| åˆ›å»ºä»»åŠ¡ | `write(/team/tasks/TASK-001.md)` |
| åˆ†é…ä»»åŠ¡ | `exec(/team/tasks/TASK-001, {action: 'assign', to: 'alice'})` |
| æ›´æ–°çŠ¶æ€ | `exec(/team/tasks/TASK-001, {action: 'status', value: 'done'})` |
| ä»»åŠ¡åˆ—è¡¨ | `list(/team/tasks/)` |
| æŒ‰çŠ¶æ€è¿‡æ»¤ | `list(/team/tasks/, {filter: {status: 'active'}})` |
| **æˆå‘˜ç®¡ç†** | |
| æˆå‘˜åˆ—è¡¨ | `list(/team/members/)` |
| æˆå‘˜èµ„æ–™ | `read(/team/members/alice/profile)` |
| æ›´æ–°èµ„æ–™ | `write(/team/members/alice/profile, {...})` |
| **AI ç”Ÿæˆå†…å®¹** | |
| æ¯æ—¥æ‘˜è¦ | Agent â†’ `write(/team/reports/daily/2026-01-17.md)` |
| ä»»åŠ¡ç´¢å¼• | Agent â†’ `write(/team/indexes/tasks-by-status.md)` |
| æ´»åŠ¨è§†å›¾ | Agent â†’ `write(/team/views/recent-activity.md)` |

### æ•°æ®ç»“æ„

```
/team/
â”œâ”€â”€ discussions/                    # è®¨è®ºå¸–
â”‚   â””â”€â”€ 2026-01-17-cli-design.md
â”œâ”€â”€ messages/                       # æ¶ˆæ¯
â”‚   â””â”€â”€ alice/
â”‚       â””â”€â”€ 2026-01-17-001.md
â”œâ”€â”€ tasks/                          # ä»»åŠ¡
â”‚   â””â”€â”€ TASK-001.md
â”œâ”€â”€ members/                        # æˆå‘˜
â”‚   â”œâ”€â”€ alice/
â”‚   â”‚   â””â”€â”€ profile.md
â”‚   â””â”€â”€ bob/
â”‚       â””â”€â”€ profile.md
â”œâ”€â”€ decisions/                      # å†³ç­–è®°å½•
â”‚   â””â”€â”€ ADR-001-use-afs.md
â”‚
â”œâ”€â”€ reports/                        # AI ç”Ÿæˆ
â”‚   â”œâ”€â”€ daily/
â”‚   â”‚   â””â”€â”€ 2026-01-17.md
â”‚   â””â”€â”€ weekly/
â”‚       â””â”€â”€ 2026-W03.md
â”œâ”€â”€ indexes/                        # AI ç”Ÿæˆ
â”‚   â””â”€â”€ tasks-by-status.md
â””â”€â”€ views/                          # AI ç”Ÿæˆ
    â”œâ”€â”€ active-tasks.md
    â””â”€â”€ recent-activity.md
```

### æ ¸å¿ƒä¼˜åŠ¿

```
ä¼ ç»Ÿåä½œç³»ç»Ÿï¼š
  Forum App + Docs App + Tasks App â†’ å„è‡ªæ•°æ®åº“ â†’ æ•°æ®å­¤å²›

Team AFSï¼š
  ç»Ÿä¸€ /team/* å‘½åç©ºé—´ â†’ AI å¯è®¿é—®å…¨éƒ¨ä¸Šä¸‹æ–‡ â†’ è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š/ç´¢å¼•
```

### å®æ—¶åä½œ

```
Alice                           AFSD                          Bob
  â”‚                               â”‚                             â”‚
  â”‚  Subscribe(/team/tasks/**)    â”‚  Subscribe(/team/tasks/**) â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                               â”‚                             â”‚
  â”‚  write(/team/tasks/TASK-002)  â”‚                             â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                             â”‚
  â”‚                               â”‚  DataChanged(TASK-002)      â”‚
  â”‚                               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                               â”‚                             â”‚
  â”‚                               â”‚     Bob æ”¶åˆ°æ–°ä»»åŠ¡é€šçŸ¥        â”‚
```

### éªŒè¯ç»“è®º

```
âœ… Team AFS åœºæ™¯å®Œå…¨å¯è¡Œ
âœ… read/write/list/exec è¦†ç›–æ‰€æœ‰åä½œåŠŸèƒ½
âœ… Subscribe + DataChanged æ”¯æŒå®æ—¶é€šçŸ¥
âœ… AI Agent å¯è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š/ç´¢å¼•/è§†å›¾
âœ… æ— éœ€ä¿®æ”¹ AFSD æ ¸å¿ƒè®¾è®¡
âœ… è¿™æ­£æ˜¯ AFS "Append-mostly å›¢é˜Ÿæ•°æ®ä¸–ç•Œ" çš„æ ¸å¿ƒåœºæ™¯
```

---

## 17. åœºæ™¯éªŒè¯ï¼šä¸ªäºº Blog / ç«™ç‚¹ / Bookmark

> ä¸ªäººå†…å®¹å‘å¸ƒã€çŸ¥è¯†ç®¡ç†ã€ç¨åé˜…è¯»

### åœºæ™¯æè¿°

```
ç”¨ AFS æ„å»ºä¸ªäººå†…å®¹ç³»ç»Ÿï¼š
- Blogï¼šå†™ä½œã€å‘å¸ƒã€ç´¢å¼•
- ä¸ªäººç«™ç‚¹ï¼šé¡µé¢ã€èµ„æºç®¡ç†
- Bookmark/Readlaterï¼šæ”¶è—ã€å¿«ç…§ã€è‡ªåŠ¨æ•´ç†
```

### åŠŸèƒ½æ˜ å°„

| åŠŸèƒ½ | AFS æ“ä½œ |
|-----|---------|
| **Blog** | |
| å†™æ–‡ç«  | `write(/blog/posts/2026-01-17-my-post.md)` |
| è¯»æ–‡ç«  | `read(/blog/posts/...)` |
| æ–‡ç« åˆ—è¡¨ | `list(/blog/posts/)` |
| æŒ‰æ ‡ç­¾è¿‡æ»¤ | `list(/blog/posts/, {filter: {tag: 'tech'}})` |
| æ ‡ç­¾ç´¢å¼• | Agent â†’ `write(/blog/indexes/by-tag.md)` |
| å½’æ¡£ç´¢å¼• | Agent â†’ `write(/blog/indexes/by-month.md)` |
| RSS ç”Ÿæˆ | Agent â†’ `write(/blog/feed.xml)` |
| **ä¸ªäººç«™ç‚¹** | |
| é¡µé¢å†…å®¹ | `read/write(/site/pages/about.md)` |
| é™æ€èµ„æº | `read(/site/assets/logo.png)` |
| ç«™ç‚¹é…ç½® | `read/write(/site/config.yaml)` |
| é™æ€ç”Ÿæˆ | `exec(/site, {action: 'build'})` â†’ ç”Ÿæˆ HTML |
| **Bookmark/Readlater** | |
| ä¿å­˜ä¹¦ç­¾ | `write(/bookmarks/2026-01-17-article.md, {url, title, notes})` |
| ä¹¦ç­¾åˆ—è¡¨ | `list(/bookmarks/)` |
| ä¿å­˜å¿«ç…§ | `exec(/bookmarks/article, {action: 'archive'})` |
| è‡ªåŠ¨æ‘˜è¦ | Agent â†’ è¯»å–å†…å®¹ç”Ÿæˆæ‘˜è¦å†™å…¥ metadata |
| è‡ªåŠ¨æ ‡ç­¾ | Agent â†’ åˆ†æå†…å®¹æ‰“æ ‡ç­¾ |
| å…¨æ–‡æœç´¢ | `exec(/bookmarks, {action: 'search', query: '...'})` |

### æ•°æ®ç»“æ„

```
/personal/
â”œâ”€â”€ blog/
â”‚   â”œâ”€â”€ posts/
â”‚   â”‚   â”œâ”€â”€ 2026-01-17-afs-design.md
â”‚   â”‚   â””â”€â”€ 2026-01-15-hello-world.md
â”‚   â”œâ”€â”€ drafts/
â”‚   â”‚   â””â”€â”€ wip-article.md
â”‚   â”œâ”€â”€ indexes/                    # Agent ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ by-tag.md
â”‚   â”‚   â””â”€â”€ by-month.md
â”‚   â””â”€â”€ feed.xml                    # Agent ç”Ÿæˆ
â”‚
â”œâ”€â”€ site/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ index.md
â”‚   â”‚   â””â”€â”€ about.md
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â””â”€â”€ logo.png
â”‚   â””â”€â”€ config.yaml
â”‚
â””â”€â”€ bookmarks/
    â”œâ”€â”€ 2026-01-17-interesting-article.md
    â”œâ”€â”€ 2026-01-16-research-paper.md
    â”œâ”€â”€ archives/                   # ç½‘é¡µå¿«ç…§
    â”‚   â””â”€â”€ 2026-01-17-xxx.html
    â””â”€â”€ indexes/                    # Agent ç”Ÿæˆ
        â”œâ”€â”€ by-tag.md
        â”œâ”€â”€ by-domain.md
        â””â”€â”€ unread.md
```

### Metadata ç¤ºä¾‹

```yaml
# /bookmarks/2026-01-17-interesting-article.md çš„ metadata
path: /bookmarks/2026-01-17-interesting-article.md
type: bookmark
url: https://example.com/article
title: "Interesting Article About AFS"
saved_at: 2026-01-17T10:30:00Z
status: unread                      # unread / read / archived

# Agent è‡ªåŠ¨ç”Ÿæˆ
summary: "è¿™ç¯‡æ–‡ç« è®¨è®ºäº†åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„è®¾è®¡åŸåˆ™..."
tags: [tech, distributed-systems, architecture]
reading_time: 8min
domain: example.com
```

### Agent è‡ªåŠ¨åŒ–

```
Agent ç›‘æ§ /bookmarks/**ï¼š
1. æ–°ä¹¦ç­¾ â†’ è‡ªåŠ¨æŠ“å–å…¨æ–‡
2. æ–°ä¹¦ç­¾ â†’ è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦
3. æ–°ä¹¦ç­¾ â†’ è‡ªåŠ¨æ‰“æ ‡ç­¾
4. å®šæœŸ â†’ æ›´æ–°ç´¢å¼•
5. å®šæœŸ â†’ æ£€æµ‹æ­»é“¾
```

### éªŒè¯ç»“è®º

```
âœ… ä¸ªäºº Blog/ç«™ç‚¹/Bookmark åœºæ™¯å®Œå…¨å¯è¡Œ
âœ… read/write/list/exec è¦†ç›–æ‰€æœ‰åŠŸèƒ½
âœ… Agent è‡ªåŠ¨åŒ–å¢å¼ºï¼šæ‘˜è¦ã€æ ‡ç­¾ã€ç´¢å¼•
âœ… æ— éœ€ä¿®æ”¹ AFSD æ ¸å¿ƒè®¾è®¡
```

---

## 18. åœºæ™¯éªŒè¯ï¼šç¤¾äº¤åª’ä½“ / IM / ä¿¡æ¯èšåˆ

> ç¤¾äº¤ç½‘ç»œã€å³æ—¶é€šè®¯ã€å¤šæºä¿¡æ¯èšåˆ

### åœºæ™¯æè¿°

```
ç”¨ AFS æ„å»ºç¤¾äº¤å’Œé€šè®¯ç³»ç»Ÿï¼š
- ç¤¾äº¤åª’ä½“ï¼šå‘å¸–ã€å…³æ³¨ã€äº’åŠ¨
- IMï¼šå®æ—¶æ¶ˆæ¯ã€ç¾¤èŠ
- ä¿¡æ¯èšåˆï¼šRSSã€å¤šå¹³å°æ•´åˆ
```

### åŠŸèƒ½æ˜ å°„

| åŠŸèƒ½ | AFS æ“ä½œ |
|-----|---------|
| **ç¤¾äº¤åª’ä½“** | |
| å‘å¸– | `write(/social/posts/2026-01-17-001.md)` |
| è¯»å¸– | `read(/social/posts/...)` |
| æ—¶é—´çº¿ | `list(/social/timeline/)` |
| å…³æ³¨ç”¨æˆ· | `write(/social/following/alice)` |
| ç²‰ä¸åˆ—è¡¨ | `list(/social/followers/)` |
| ç‚¹èµ | `exec(/social/posts/xxx, {action: 'like'})` |
| è½¬å‘ | `exec(/social/posts/xxx, {action: 'repost'})` |
| è¯„è®º | `write(/social/posts/xxx/comments/001.md)` |
| **IMï¼ˆå³æ—¶é€šè®¯ï¼‰** | |
| å‘æ¶ˆæ¯ | `write(/im/chats/alice/2026-01-17-001.md)` |
| å®æ—¶æ¥æ”¶ | `Subscribe(/im/chats/**)` + `DataChanged` |
| æ¶ˆæ¯å†å² | `list(/im/chats/alice/)` |
| ç¾¤èŠ | `write(/im/groups/team/2026-01-17-001.md)` |
| å·²è¯»å›æ‰§ | `exec(/im/chats/alice, {action: 'mark_read', until: '001'})` |
| åœ¨çº¿çŠ¶æ€ | `read(/im/presence/alice)` |
| **ä¿¡æ¯èšåˆ** | |
| RSS è®¢é˜… | mount RSS Provider â†’ `/feeds/rss/techcrunch/*` |
| ç¤¾äº¤èšåˆ | mount Twitter Provider â†’ `/feeds/twitter/*` |
| å¤šæºæ—¶é—´çº¿ | Agent â†’ `write(/feeds/unified/timeline.md)` |
| æ™ºèƒ½æ‘˜è¦ | Agent â†’ `write(/feeds/daily-digest.md)` |

### æ•°æ®ç»“æ„

```
/social/
â”œâ”€â”€ posts/                          # æˆ‘çš„å¸–å­
â”‚   â””â”€â”€ 2026-01-17-001.md
â”œâ”€â”€ timeline/                       # æ—¶é—´çº¿ï¼ˆAgent èšåˆï¼‰
â”‚   â””â”€â”€ 2026-01-17.md
â”œâ”€â”€ following/                      # å…³æ³¨åˆ—è¡¨
â”‚   â”œâ”€â”€ alice
â”‚   â””â”€â”€ bob
â”œâ”€â”€ followers/                      # ç²‰ä¸åˆ—è¡¨
â”‚   â””â”€â”€ charlie
â””â”€â”€ notifications/                  # é€šçŸ¥
    â””â”€â”€ 2026-01-17-001.md

/im/
â”œâ”€â”€ chats/                          # ç§èŠ
â”‚   â”œâ”€â”€ alice/
â”‚   â”‚   â”œâ”€â”€ 2026-01-17-001.md
â”‚   â”‚   â””â”€â”€ 2026-01-17-002.md
â”‚   â””â”€â”€ bob/
â”œâ”€â”€ groups/                         # ç¾¤èŠ
â”‚   â””â”€â”€ team/
â”‚       â””â”€â”€ 2026-01-17-001.md
â””â”€â”€ presence/                       # åœ¨çº¿çŠ¶æ€
    â”œâ”€â”€ alice                       # online / offline / away
    â””â”€â”€ bob

/feeds/
â”œâ”€â”€ rss/                            # RSS Provider mount
â”‚   â”œâ”€â”€ techcrunch/
â”‚   â””â”€â”€ hackernews/
â”œâ”€â”€ twitter/                        # Twitter Provider mount
â”‚   â””â”€â”€ timeline/
â”œâ”€â”€ unified/                        # Agent èšåˆ
â”‚   â””â”€â”€ timeline.md
â””â”€â”€ daily-digest.md                 # Agent ç”Ÿæˆæ¯æ—¥æ‘˜è¦
```

### å®æ—¶æ¶ˆæ¯æµç¨‹

```
Alice                           AFSD                          Bob
  â”‚                               â”‚                             â”‚
  â”‚  Subscribe(/im/chats/bob/**)  â”‚                             â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                             â”‚
  â”‚                               â”‚                             â”‚
  â”‚                               â”‚  write(/im/chats/alice/001) â”‚
  â”‚                               â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                               â”‚                             â”‚
  â”‚  DataChanged(/im/chats/       â”‚                             â”‚
  â”‚    alice/001)                 â”‚                             â”‚
  â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                             â”‚
  â”‚                               â”‚                             â”‚
  â”‚  read(/im/chats/bob/001)      â”‚                             â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                             â”‚
  â”‚  ReadResult(message content)  â”‚                             â”‚
  â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                             â”‚
```

### ä¿¡æ¯èšåˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AFS å‘½åç©ºé—´                                                â”‚
â”‚                                                             â”‚
â”‚  /feeds/rss/*      â† mount â† RSS Provider (fetch & parse)   â”‚
â”‚  /feeds/twitter/*  â† mount â† Twitter Provider (API)         â”‚
â”‚  /feeds/mastodon/* â† mount â† Mastodon Provider (API)        â”‚
â”‚  /feeds/email/*    â† mount â† Email Provider (newsletter)    â”‚
â”‚                                                             â”‚
â”‚  /feeds/unified/*  â† Agent èšåˆæ‰€æœ‰æºï¼Œç”Ÿæˆç»Ÿä¸€æ—¶é—´çº¿          â”‚
â”‚  /feeds/digest/*   â† Agent ç”Ÿæˆæ¯æ—¥/æ¯å‘¨æ‘˜è¦                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®èƒ½åŠ›

```
Subscribe + DataChanged  â†’ IM å®æ—¶æ€§
å¤š Provider mount       â†’ å¤šæºèšåˆ
Agent å¤„ç†              â†’ æ™ºèƒ½æ¨èã€è¿‡æ»¤ã€æ‘˜è¦
Metadata                â†’ å·²è¯»çŠ¶æ€ã€åœ¨çº¿çŠ¶æ€
```

### éªŒè¯ç»“è®º

```
âœ… ç¤¾äº¤åª’ä½“/IM/ä¿¡æ¯èšåˆåœºæ™¯å®Œå…¨å¯è¡Œ
âœ… Subscribe + DataChanged æ»¡è¶³å®æ—¶æ€§è¦æ±‚
âœ… å¤š Provider mount å®ç°å¤šæºèšåˆ
âœ… Agent å¢å¼ºï¼šç»Ÿä¸€æ—¶é—´çº¿ã€æ™ºèƒ½æ‘˜è¦ã€æ¨è
âœ… æ— éœ€ä¿®æ”¹ AFSD æ ¸å¿ƒè®¾è®¡
```

---

## 19. æ½œåœ¨åœºæ™¯ï¼šæ›´å¤šå¯èƒ½æ€§

> åŸºäº AFS æ ¸å¿ƒèƒ½åŠ›çš„åœºæ™¯æ¢ç´¢

### AFS æ ¸å¿ƒèƒ½åŠ›å›é¡¾

```
read/write/list/exec/explain  â†’ ç»Ÿä¸€æ“ä½œæ¨¡å‹
Subscribe + DataChanged       â†’ å®æ—¶æ€§
Metadata                      â†’ LLM å‹å¥½çš„ä¸Šä¸‹æ–‡
Provider mount                â†’ å¼‚æ„èµ„æºç»Ÿä¸€
Agent å¤„ç†                    â†’ AI å¢å¼º
Human in the loop             â†’ äººæœºåä½œ
Append-mostly                 â†’ å®¡è®¡å‹å¥½
```

---

### 19.1 å¼€å‘è€…å·¥ä½œç©ºé—´

> å¼€å‘å…¨æµç¨‹ç»Ÿä¸€å…¥å£ï¼ŒAI åŸç”Ÿ

**æ•°æ®ç»“æ„**ï¼š
```
/dev/
â”œâ”€â”€ repos/                      # Git Provider mount
â”‚   â”œâ”€â”€ aigne-framework/
â”‚   â””â”€â”€ afsd/
â”œâ”€â”€ ci/                         # CI/CD Provider
â”‚   â”œâ”€â”€ pipelines/
â”‚   â””â”€â”€ builds/
â”œâ”€â”€ logs/                       # æ—¥å¿—èšåˆ
â”‚   â”œâ”€â”€ apps/
â”‚   â””â”€â”€ infra/
â”œâ”€â”€ deployments/                # K8s Provider mount
â”‚   â”œâ”€â”€ staging/
â”‚   â””â”€â”€ production/
â”œâ”€â”€ secrets/                    # Vault Provider mount
â”‚   â””â”€â”€ api-keys/
â””â”€â”€ metrics/                    # ç›‘æ§ Provider
    â””â”€â”€ dashboards/
```

**åŠŸèƒ½æ˜ å°„**ï¼š

| åŠŸèƒ½ | AFS æ“ä½œ |
|-----|---------|
| æŸ¥çœ‹ä»£ç  | `read(/dev/repos/project/src/main.ts)` |
| æäº¤ä»£ç  | `exec(/dev/repos/project, {action: 'commit', message: '...'})` |
| è§¦å‘æ„å»º | `exec(/dev/ci/pipelines/deploy, {branch: 'main'})` |
| æŸ¥çœ‹æ—¥å¿— | `Subscribe(/dev/logs/apps/api/**)` |
| éƒ¨ç½² | `exec(/dev/deployments/staging, {action: 'deploy', image: '...'})` |
| è¯»å–å¯†é’¥ | `read(/dev/secrets/api-keys/openai)` |

**Agent å¢å¼º**ï¼š
- ä»£ç å®¡æŸ¥ï¼šè‡ªåŠ¨å‘ç°é—®é¢˜
- å¼‚å¸¸æ£€æµ‹ï¼šæ—¥å¿—æ¨¡å¼è¯†åˆ«
- è‡ªåŠ¨ä¿®å¤ï¼šç”Ÿæˆ PR
- éƒ¨ç½²å»ºè®®ï¼šåŸºäºæŒ‡æ ‡æ¨è

**ç‹¬ç‰¹ä»·å€¼**ï¼šå¼€å‘è€…å·¥å…·é“¾ç»Ÿä¸€å…¥å£ï¼ŒAI åŸç”Ÿé›†æˆ

---

### 19.2 ä¸ªäººæ•°æ®ä¸­å¿ƒ / æ•°æ®ä¸»æƒ

> æ‰€æœ‰ä¸ªäººæ•°æ®çš„ç»Ÿä¸€å…¥å£ï¼Œæ•°æ®ä¸»æƒä¿æŠ¤

**æ•°æ®ç»“æ„**ï¼š
```
/me/
â”œâ”€â”€ health/                     # Apple Health / Fitbit Provider
â”‚   â”œâ”€â”€ vitals/
â”‚   â”œâ”€â”€ workouts/
â”‚   â””â”€â”€ sleep/
â”œâ”€â”€ finance/                    # é“¶è¡Œ API / è®°è´¦ Provider
â”‚   â”œâ”€â”€ accounts/
â”‚   â”œâ”€â”€ transactions/
â”‚   â””â”€â”€ investments/
â”œâ”€â”€ photos/                     # iCloud / Google Photos Provider
â”‚   â””â”€â”€ 2026/
â”œâ”€â”€ documents/                  # äº‘ç›˜ Provider
â”‚   â”œâ”€â”€ personal/
â”‚   â””â”€â”€ work/
â”œâ”€â”€ location/                   # ä½ç½®å†å²
â”‚   â””â”€â”€ 2026/
â”œâ”€â”€ contacts/                   # é€šè®¯å½•
â”œâ”€â”€ calendar/                   # æ—¥å† Provider
â””â”€â”€ insights/                   # Agent ç”Ÿæˆ
    â”œâ”€â”€ health-trends.md
    â”œâ”€â”€ spending-analysis.md
    â””â”€â”€ weekly-summary.md
```

**å…³é”®ç‰¹æ€§**ï¼š
```
æ•°æ®åœ¨æœ¬åœ° afsdï¼Œä¸ä¸Šä¼ äº‘ç«¯
ç”¨æˆ·å®Œå…¨æ§åˆ¶æ•°æ®è®¿é—®æƒé™
AI åˆ†æåœ¨æœ¬åœ°è¿›è¡Œ
å¯é€‰æ‹©æ€§åŒæ­¥åˆ°å…¶ä»–è®¾å¤‡
```

**Agent å¢å¼º**ï¼š
- å¥åº·è¶‹åŠ¿åˆ†æ
- æ¶ˆè´¹æ¨¡å¼æ´å¯Ÿ
- è·¨æ•°æ®æºå…³è”ï¼ˆå¦‚ï¼šè¿åŠ¨ vs ç¡çœ è´¨é‡ï¼‰
- ä¸ªæ€§åŒ–å»ºè®®

**ç‹¬ç‰¹ä»·å€¼**ï¼šæ•°æ®ä¸»æƒã€éšç§ä¿æŠ¤ã€AI ä¸ªäººåŠ©æ‰‹çš„æ•°æ®åŸºç¡€

---

### 19.3 ç¬¬äºŒå¤§è„‘ / çŸ¥è¯†å›¾è°±

> ä¸ªäººçŸ¥è¯†ç®¡ç†å’Œè‡ªåŠ¨å…³è”

**æ•°æ®ç»“æ„**ï¼š
```
/brain/
â”œâ”€â”€ notes/                      # ç¬”è®°
â”‚   â”œâ”€â”€ daily/
â”‚   â”œâ”€â”€ projects/
â”‚   â””â”€â”€ ideas/
â”œâ”€â”€ clips/                      # ç½‘é¡µæ‘˜å½•
â”‚   â””â”€â”€ 2026-01/
â”œâ”€â”€ highlights/                 # ä¹¦ç±/æ–‡ç« é«˜äº®
â”‚   â””â”€â”€ books/
â”œâ”€â”€ conversations/              # AI å¯¹è¯å†å²
â”‚   â””â”€â”€ claude/
â”œâ”€â”€ references/                 # å‚è€ƒèµ„æ–™
â”‚   â”œâ”€â”€ papers/
â”‚   â””â”€â”€ articles/
â”œâ”€â”€ connections/                # Agent å‘ç°çš„å…³è”
â”‚   â””â”€â”€ graph.json
â””â”€â”€ insights/                   # Agent ç”Ÿæˆ
    â”œâ”€â”€ weekly-review.md
    â”œâ”€â”€ topic-clusters.md
    â””â”€â”€ emerging-interests.md
```

**Agent å¢å¼º**ï¼š
- è‡ªåŠ¨å…³è”ï¼šå‘ç°ç¬”è®°é—´çš„è”ç³»
- çŸ¥è¯†å›¾è°±ï¼šæ„å»ºæ¦‚å¿µç½‘ç»œ
- é—´éš”é‡å¤ï¼šæ¨èå¤ä¹ å†…å®¹
- æ´å¯Ÿç”Ÿæˆï¼šå‘ç°æ€ç»´æ¨¡å¼

**ç‹¬ç‰¹ä»·å€¼**ï¼šç±» Obsidian ä½† AI åŸç”Ÿã€å¼€æ”¾æ¶æ„ã€è·¨å¹³å°

---

### 19.4 å¤šæ¨¡æ€å†…å®¹å·¥ä½œå®¤

> æ–‡æ¡£ã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç»Ÿä¸€ç®¡ç†

**æ•°æ®ç»“æ„**ï¼š
```
/studio/
â”œâ”€â”€ documents/                  # æ–‡æ¡£
â”‚   â””â”€â”€ project-proposal.md
â”œâ”€â”€ images/                     # å›¾ç‰‡ + AI æè¿°
â”‚   â””â”€â”€ screenshots/
â”œâ”€â”€ videos/                     # è§†é¢‘ + è½¬å½•
â”‚   â””â”€â”€ recordings/
â”œâ”€â”€ audio/                      # éŸ³é¢‘ + è½¬å½•
â”‚   â”œâ”€â”€ podcasts/
â”‚   â””â”€â”€ voice-notes/
â”œâ”€â”€ projects/                   # è·¨æ ¼å¼é¡¹ç›®
â”‚   â””â”€â”€ product-launch/
â”‚       â”œâ”€â”€ brief.md
â”‚       â”œâ”€â”€ assets/
â”‚       â””â”€â”€ timeline.md
â””â”€â”€ exports/                    # å¯¼å‡ºç‰ˆæœ¬
```

**åŠŸèƒ½æ˜ å°„**ï¼š

| åŠŸèƒ½ | AFS æ“ä½œ |
|-----|---------|
| è½¬æ¢æ ¼å¼ | `exec(/studio/videos/clip.mp4, {action: 'convert', to: 'gif'})` |
| ç”Ÿæˆç¼©ç•¥å›¾ | `exec(/studio/videos/clip.mp4, {action: 'thumbnail'})` |
| è§†é¢‘è½¬å½• | `exec(/studio/videos/clip.mp4, {action: 'transcribe'})` |
| å›¾ç‰‡æè¿° | `exec(/studio/images/photo.jpg, {action: 'describe'})` |
| è·¨æ ¼å¼æœç´¢ | `exec(/studio, {action: 'search', query: 'äº§å“å‘å¸ƒ'})` |

**Metadata ç¤ºä¾‹**ï¼š
```yaml
# /studio/videos/meeting-2026-01-17.mp4
path: /studio/videos/meeting-2026-01-17.mp4
type: video
duration: 45:32
resolution: 1920x1080
# Agent ç”Ÿæˆ
transcript: /studio/videos/meeting-2026-01-17.txt
summary: "è®¨è®ºäº† Q1 äº§å“è·¯çº¿å›¾ï¼Œå†³å®šä¼˜å…ˆå¼€å‘..."
speakers: [alice, bob, charlie]
topics: [roadmap, product, Q1]
action_items:
  - "Alice: å®Œæˆè®¾è®¡ç¨¿"
  - "Bob: æŠ€æœ¯è¯„ä¼°"
```

**ç‹¬ç‰¹ä»·å€¼**ï¼šç»Ÿä¸€ metadata è®© AI ç†è§£æ‰€æœ‰æ ¼å¼å†…å®¹

---

### 19.5 AI Agent çš„è®°å¿†å±‚

> AI åŠ©æ‰‹çš„é•¿æœŸè®°å¿†åŸºç¡€è®¾æ–½

**æ•°æ®ç»“æ„**ï¼š
```
/agent-memory/
â”œâ”€â”€ conversations/              # å¯¹è¯å†å²
â”‚   â”œâ”€â”€ 2026-01-17-001.md
â”‚   â””â”€â”€ 2026-01-17-002.md
â”œâ”€â”€ learned/                    # å­¦ä¹ åˆ°çš„ç”¨æˆ·åå¥½
â”‚   â”œâ”€â”€ preferences.yaml
â”‚   â”œâ”€â”€ writing-style.md
â”‚   â””â”€â”€ technical-context.md
â”œâ”€â”€ context/                    # é•¿æœŸä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ current-projects.md
â”‚   â”œâ”€â”€ relationships.md
â”‚   â””â”€â”€ goals.md
â”œâ”€â”€ tools/                      # å¯ç”¨å·¥å…·æ³¨å†Œ
â”‚   â””â”€â”€ registry.yaml
â”œâ”€â”€ feedback/                   # ç”¨æˆ·åé¦ˆ
â”‚   â””â”€â”€ corrections.md
â””â”€â”€ knowledge/                  # ç§¯ç´¯çš„çŸ¥è¯†
    â”œâ”€â”€ facts.md
    â””â”€â”€ procedures.md
```

**æ ¸å¿ƒä»·å€¼**ï¼š
```
è§£å†³ AI æ— çŠ¶æ€é—®é¢˜
è·¨ session ä¿æŒä¸Šä¸‹æ–‡
å­¦ä¹ ç”¨æˆ·åå¥½
ç§¯ç´¯é¢†åŸŸçŸ¥è¯†
```

**ä½¿ç”¨æµç¨‹**ï¼š
```
1. AI å¯åŠ¨æ—¶ read(/agent-memory/context/*)
2. å¯¹è¯ä¸­ read(/agent-memory/learned/preferences.yaml)
3. å‘ç°æ–°ä¿¡æ¯ write(/agent-memory/knowledge/facts.md, append)
4. ç”¨æˆ·çº æ­£ write(/agent-memory/feedback/corrections.md)
5. å®šæœŸ Agent æ•´ç†å’Œå‹ç¼©è®°å¿†
```

**ç‹¬ç‰¹ä»·å€¼**ï¼šAFS æ˜¯ AI é•¿æœŸè®°å¿†çš„æœ€ä½³åŸºç¡€è®¾æ–½

---

### 19.6 åˆ†å¸ƒå¼è®¡ç®— / ä»»åŠ¡è°ƒåº¦

> ç®€åŒ–ç‰ˆ MapReduceï¼ŒAI å·¥ä½œæµå‹å¥½

**æ•°æ®ç»“æ„**ï¼š
```
/compute/
â”œâ”€â”€ tasks/                      # ä»»åŠ¡é˜Ÿåˆ—
â”‚   â”œâ”€â”€ pending/
â”‚   â”œâ”€â”€ running/
â”‚   â””â”€â”€ completed/
â”œâ”€â”€ workers/                    # è®¡ç®—èŠ‚ç‚¹ Provider
â”‚   â”œâ”€â”€ gpu-1/
â”‚   â”œâ”€â”€ gpu-2/
â”‚   â””â”€â”€ cpu-pool/
â”œâ”€â”€ results/                    # ç»“æœå­˜å‚¨
â”‚   â””â”€â”€ job-001/
â”œâ”€â”€ datasets/                   # æ•°æ®é›†
â”‚   â””â”€â”€ training-data/
â””â”€â”€ status/                     # çŠ¶æ€ç›‘æ§
    â””â”€â”€ dashboard.md
```

**åŠŸèƒ½æ˜ å°„**ï¼š

| åŠŸèƒ½ | AFS æ“ä½œ |
|-----|---------|
| æäº¤ä»»åŠ¡ | `write(/compute/tasks/pending/job-001.yaml)` |
| æ‰§è¡Œä»»åŠ¡ | `exec(/compute/workers/gpu-1, {job: 'job-001'})` |
| ç›‘æ§è¿›åº¦ | `Subscribe(/compute/tasks/running/**)` |
| è·å–ç»“æœ | `read(/compute/results/job-001/)` |
| æŸ¥çœ‹çŠ¶æ€ | `read(/compute/workers/gpu-1/status)` |

**ç‹¬ç‰¹ä»·å€¼**ï¼šç®€åŒ–ç‰ˆåˆ†å¸ƒå¼è®¡ç®—ï¼Œå¯¹ AI æ‰¹é‡å¤„ç†ç‰¹åˆ«é€‚åˆ

---

### 19.7 API èšåˆå±‚ / BFF

> AI-native API Gateway

**æ•°æ®ç»“æ„**ï¼š
```
/api/
â”œâ”€â”€ weather/                    # å¤©æ°” API Provider
â”‚   â””â”€â”€ current/
â”œâ”€â”€ maps/                       # åœ°å›¾ API Provider
â”‚   â””â”€â”€ geocode/
â”œâ”€â”€ payments/                   # æ”¯ä»˜ API Provider
â”‚   â””â”€â”€ transactions/
â”œâ”€â”€ ai/                         # AI API Provider
â”‚   â”œâ”€â”€ openai/
â”‚   â””â”€â”€ anthropic/
â”œâ”€â”€ unified/                    # Agent èšåˆçš„ç»Ÿä¸€æ¥å£
â”‚   â””â”€â”€ travel-planner/
â””â”€â”€ schemas/                    # API æè¿°
    â””â”€â”€ openapi/
```

**Agent ä½¿ç”¨**ï¼š
```
Agent æƒ³è¦è§„åˆ’æ—…è¡Œï¼š
1. read(/api/weather/forecast?location=tokyo)
2. read(/api/maps/places?query=hotels+tokyo)
3. exec(/api/payments/quote, {amount: 1000, currency: 'JPY'})
4. ç»¼åˆç»“æœç”Ÿæˆå»ºè®®
```

**ç‹¬ç‰¹ä»·å€¼**ï¼šAgent å¯ä»¥ç†è§£å’Œç»„åˆä»»æ„ API

---

### 19.8 æ•°å­—å­ªç”Ÿ

> ç‰©ç†ä¸–ç•Œçš„æ•°å­—æ˜ å°„

**æ•°æ®ç»“æ„**ï¼š
```
/twin/
â”œâ”€â”€ factory/                    # å·¥å‚è®¾å¤‡
â”‚   â”œâ”€â”€ machines/
â”‚   â”‚   â”œâ”€â”€ cnc-001/
â”‚   â”‚   â””â”€â”€ cnc-002/
â”‚   â”œâ”€â”€ sensors/
â”‚   â””â”€â”€ alarms/
â”œâ”€â”€ building/                   # å»ºç­‘ç®¡ç†
â”‚   â”œâ”€â”€ hvac/
â”‚   â”œâ”€â”€ lighting/
â”‚   â””â”€â”€ access/
â”œâ”€â”€ fleet/                      # è½¦é˜Ÿç®¡ç†
â”‚   â”œâ”€â”€ vehicles/
â”‚   â””â”€â”€ routes/
â”œâ”€â”€ history/                    # å†å²æ•°æ®
â”‚   â””â”€â”€ 2026-01/
â””â”€â”€ simulations/                # ä»¿çœŸç»“æœ
    â””â”€â”€ what-if/
```

**åŠŸèƒ½æ˜ å°„**ï¼š

| åŠŸèƒ½ | AFS æ“ä½œ |
|-----|---------|
| å®æ—¶çŠ¶æ€ | `Subscribe(/twin/factory/machines/**/status)` |
| å†å²æŸ¥è¯¢ | `read(/twin/history/2026-01/machines/cnc-001)` |
| æ§åˆ¶è®¾å¤‡ | `exec(/twin/factory/machines/cnc-001, {action: 'stop'})` |
| è¿è¡Œä»¿çœŸ | `exec(/twin/simulations, {scenario: 'peak-load'})` |

**ç‹¬ç‰¹ä»·å€¼**ï¼šç‰©ç†ä¸–ç•Œçš„ç»Ÿä¸€æ•°å­—æ¥å£ï¼ŒAI å¯ç†è§£å’Œæ§åˆ¶

---

### 19.9 åˆè§„ä¸å®¡è®¡

> ä¸å¯ç¯¡æ”¹çš„å®¡è®¡è½¨è¿¹

**æ•°æ®ç»“æ„**ï¼š
```
/compliance/
â”œâ”€â”€ contracts/                  # åˆåŒç®¡ç†
â”‚   â”œâ”€â”€ active/
â”‚   â”œâ”€â”€ expired/
â”‚   â””â”€â”€ templates/
â”œâ”€â”€ audit-logs/                 # å®¡è®¡æ—¥å¿—ï¼ˆappend-onlyï¼‰
â”‚   â””â”€â”€ 2026-01/
â”œâ”€â”€ policies/                   # æ”¿ç­–æ–‡æ¡£
â”‚   â”œâ”€â”€ security/
â”‚   â”œâ”€â”€ privacy/
â”‚   â””â”€â”€ hr/
â”œâ”€â”€ evidence/                   # åˆè§„è¯æ®
â”‚   â””â”€â”€ certifications/
â””â”€â”€ reports/                    # Agent ç”Ÿæˆ
    â”œâ”€â”€ quarterly-audit.md
    â””â”€â”€ risk-assessment.md
```

**AFS å¤©ç„¶ä¼˜åŠ¿**ï¼š
```
Append-mostly æ¨¡å‹ â†’ ä¸å¯ç¯¡æ”¹
å®Œæ•´å†å² â†’ å¯è¿½æº¯
Metadata â†’ åˆ†ç±»å’Œæ£€ç´¢
Agent â†’ è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š
```

**ç‹¬ç‰¹ä»·å€¼**ï¼šå¤©ç„¶é€‚åˆå®¡è®¡å’Œåˆè§„åœºæ™¯

---

### 19.10 æ•™è‚²å¹³å°

> AI è¾…å¯¼å¤©ç„¶é›†æˆ

**æ•°æ®ç»“æ„**ï¼š
```
/edu/
â”œâ”€â”€ courses/                    # è¯¾ç¨‹å†…å®¹
â”‚   â””â”€â”€ intro-to-programming/
â”‚       â”œâ”€â”€ syllabus.md
â”‚       â”œâ”€â”€ lessons/
â”‚       â””â”€â”€ materials/
â”œâ”€â”€ assignments/                # ä½œä¸š
â”‚   â””â”€â”€ intro-to-programming/
â”‚       â”œâ”€â”€ hw-001/
â”‚       â”‚   â”œâ”€â”€ description.md
â”‚       â”‚   â””â”€â”€ submissions/
â”‚       â””â”€â”€ hw-002/
â”œâ”€â”€ students/                   # å­¦ç”Ÿ
â”‚   â””â”€â”€ alice/
â”‚       â”œâ”€â”€ progress.md
â”‚       â”œâ”€â”€ submissions/
â”‚       â””â”€â”€ feedback/
â”œâ”€â”€ tutoring/                   # AI è¾…å¯¼
â”‚   â””â”€â”€ sessions/
â””â”€â”€ analytics/                  # Agent ç”Ÿæˆ
    â”œâ”€â”€ class-progress.md
    â””â”€â”€ struggling-topics.md
```

**åŠŸèƒ½æ˜ å°„**ï¼š

| åŠŸèƒ½ | AFS æ“ä½œ |
|-----|---------|
| æäº¤ä½œä¸š | `write(/edu/assignments/hw-001/submissions/alice.py)` |
| è‡ªåŠ¨æ‰¹æ”¹ | `exec(/edu/assignments/hw-001/submissions/alice.py, {action: 'grade'})` |
| AI è¾…å¯¼ | `exec(/edu/tutoring, {question: 'å¦‚ä½•ç†è§£é€’å½’ï¼Ÿ'})` |
| æŸ¥çœ‹è¿›åº¦ | `read(/edu/students/alice/progress.md)` |

**ç‹¬ç‰¹ä»·å€¼**ï¼šAI è¾…å¯¼å’Œè‡ªåŠ¨æ‰¹æ”¹å¤©ç„¶é›†æˆ

---

### åœºæ™¯ä»·å€¼è¯„ä¼°

| åœºæ™¯ | ä»·å€¼ | ç†ç”± |
|-----|------|------|
| **AI Agent è®°å¿†å±‚** | â­â­â­â­â­ | AFS æ˜¯ AI é•¿æœŸè®°å¿†çš„æœ€ä½³åŸºç¡€è®¾æ–½ |
| **ä¸ªäººæ•°æ®ä¸­å¿ƒ** | â­â­â­â­â­ | æ•°æ®ä¸»æƒ + AI åŠ©æ‰‹ï¼Œåˆšéœ€ |
| **ç¬¬äºŒå¤§è„‘** | â­â­â­â­ | çŸ¥è¯†ç®¡ç† + AIï¼Œå¸‚åœºæˆç†Ÿ |
| **å¼€å‘è€…å·¥ä½œç©ºé—´** | â­â­â­â­ | å¼€å‘è€…æ˜¯æ—©æœŸé‡‡ç”¨è€… |
| **å¤šæ¨¡æ€å·¥ä½œå®¤** | â­â­â­â­ | å†…å®¹åˆ›ä½œè€…éœ€æ±‚ |
| **API èšåˆå±‚** | â­â­â­ | æŠ€æœ¯åœºæ™¯ï¼ŒéªŒè¯ AFS é€šç”¨æ€§ |
| **åˆ†å¸ƒå¼è®¡ç®—** | â­â­â­ | AI å·¥ä½œæµéœ€æ±‚ |
| **æ•°å­—å­ªç”Ÿ** | â­â­â­ | å·¥ä¸šåœºæ™¯ï¼Œé«˜ä»·å€¼ä½†å‚ç›´ |
| **åˆè§„å®¡è®¡** | â­â­â­ | ä¼ä¸šåˆšéœ€ï¼ŒAFS å¤©ç„¶é€‚åˆ |
| **æ•™è‚²å¹³å°** | â­â­â­ | AI è¾…å¯¼è¶‹åŠ¿ |

---

## 20. å®Œæ•´æŠ€æœ¯æ ˆï¼šArcBlock AI-native ä½“ç³»

> AFS ä¸æ˜¯å­¤ç«‹å­˜åœ¨ï¼Œè€Œæ˜¯å®Œæ•´æŠ€æœ¯æ ˆçš„ä¸€éƒ¨åˆ†

### ä½“ç³»æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ArcBlock AI æŠ€æœ¯æ ˆ                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  AIGNE (Agent Framework)                                â”‚â”‚
â”‚  â”‚  æ„å»º Agent çš„æ¡†æ¶                                       â”‚â”‚
â”‚  â”‚  - å®šä¹‰ Agent è¡Œä¸º                                       â”‚â”‚
â”‚  â”‚  - ç»„åˆ Skills/Tools                                    â”‚â”‚
â”‚  â”‚  - Workflow ç¼–æ’                                        â”‚â”‚
â”‚  â”‚  - Multi-agent åä½œ                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                            â”‚                                 â”‚
â”‚                            â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  AINE (Runtime & Agent Infra & Creation Environment)    â”‚â”‚
â”‚  â”‚  é€šç”¨è¿è¡Œæ—¶æ¡†æ¶ + Agent åŸºç¡€è®¾æ–½ + åˆ›é€ ç¯å¢ƒ               â”‚â”‚
â”‚  â”‚  - Agent è¿è¡Œç¯å¢ƒ                                        â”‚â”‚
â”‚  â”‚  - Agent æ„å»º App çš„ç¯å¢ƒï¼ˆAgent å¯ä»¥åˆ›é€ æ–° Appï¼‰         â”‚â”‚
â”‚  â”‚  - åŒ…å« AFSDï¼ˆä¸–ç•Œå®¿ä¸»ï¼‰                                 â”‚â”‚
â”‚  â”‚  - å¯è§‚æµ‹æ€§ï¼ˆAIGNE Observeï¼‰                             â”‚â”‚
â”‚  â”‚  - ç”Ÿå‘½å‘¨æœŸç®¡ç†                                          â”‚â”‚
â”‚  â”‚  - Blocklet å…¼å®¹å±‚                                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                            â”‚                                 â”‚
â”‚                            â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  AFS + AFSD (Control Surface)                           â”‚â”‚
â”‚  â”‚  ç»Ÿä¸€è®¿é—®æ¥å£ + ç½‘ç»œåŒ–æœåŠ¡                                â”‚â”‚
â”‚  â”‚  - read/write/list/exec/explain                         â”‚â”‚
â”‚  â”‚  - Provider mountï¼ˆå¼‚æ„èµ„æºç»Ÿä¸€ï¼‰                        â”‚â”‚
â”‚  â”‚  - Metadataï¼ˆLLM è¯´æ˜ä¹¦ï¼‰                                â”‚â”‚
â”‚  â”‚  - Subscribe + DataChangedï¼ˆå®æ—¶æ€§ï¼‰                     â”‚â”‚
â”‚  â”‚  - Human in the loop                                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                            â”‚                                 â”‚
â”‚                            â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  AFS-UI (View Projection)                               â”‚â”‚
â”‚  â”‚  è§†å›¾æŠ•å½±å±‚                                              â”‚â”‚
â”‚  â”‚  - Web / CLI / Agent ç­‰ä»·æŠ•å½±                           â”‚â”‚
â”‚  â”‚  - UI ä¸è®¡ç®—ï¼Œåªæ¸²æŸ“                                     â”‚â”‚
â”‚  â”‚  - Human å’Œ AI çœ‹åˆ°ç›¸åŒä¸–ç•Œ                              â”‚â”‚
â”‚  â”‚  - Agent ç”Ÿæˆ viewsï¼ŒUI æ¸²æŸ“                            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å„å±‚èŒè´£

| å±‚ | å®šä½ | èŒè´£ | ç±»æ¯” |
|---|------|------|------|
| **AIGNE** | Agent Framework | æ„å»º Agent çš„æ¡†æ¶ | Reactï¼ˆæ„å»ºç»„ä»¶ï¼‰ |
| **AINE** | Runtime & Creation | è¿è¡Œ Agent + Agent æ„å»º App çš„ç¯å¢ƒ | Node.js + Vercel |
| **AFS/AFSD** | Control Surface | è®¿é—®å’Œæ§åˆ¶èµ„æº | æ–‡ä»¶ç³»ç»Ÿ + ç½‘ç»œ |
| **AFS-UI** | View Projection | å±•ç¤ºè§†å›¾ç»™äººç±» | æµè§ˆå™¨æ¸²æŸ“ |

### AINE çš„åŒé‡è§’è‰²

```
AINE ä¸ä»…æ˜¯è¿è¡Œç¯å¢ƒï¼Œä¹Ÿæ˜¯åˆ›é€ ç¯å¢ƒã€‚

è¿è¡Œè§’è‰²ï¼š
  - Agent åœ¨ AINE ä¸Šè¿è¡Œ
  - AINE æä¾› AFSDã€å¯è§‚æµ‹æ€§ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†

åˆ›é€ è§’è‰²ï¼š
  - Agent å¯ä»¥åœ¨ AINE ä¸Šæ„å»ºæ–°çš„ App
  - Agent å¯ä»¥åˆ›é€ æ–°çš„ Agent
  - è‡ªä¸¾èƒ½åŠ›ï¼šç³»ç»Ÿå¯ä»¥è‡ªæˆ‘æ‰©å±•
```

**è¿™æ„å‘³ç€**ï¼š
```
Human ç”¨ AIGNE æ„å»º Agent
        â†“
Agent è¿è¡Œåœ¨ AINE ä¸Š
        â†“
Agent ä¹Ÿå¯ä»¥ç”¨ AINE æ„å»ºæ–° App
        â†“
æ–° App ç»§ç»­è¿è¡Œåœ¨ AINE ä¸Š
        â†“
æ— é™æ‰©å±•çš„èƒ½åŠ›
```

**ç±»æ¯”**ï¼š
```
ä¼ ç»Ÿ: å¼€å‘è€…å†™ä»£ç  â†’ éƒ¨ç½² â†’ ç”¨æˆ·ä½¿ç”¨
AINE: å¼€å‘è€…æ„å»º Agent â†’ Agent è¿è¡Œ â†’ Agent æ„å»ºæ–° App â†’ æ–° App è¿è¡Œ
                                    â†‘
                              è¿™æ˜¯å…³é”®å·®å¼‚
```

### å®Œæ•´æµç¨‹

```
å¼€å‘é˜¶æ®µï¼š
  å¼€å‘è€…ç”¨ AIGNE æ„å»º Agent
  â†“
  å®šä¹‰ Agent çš„ instructionsã€skillsã€tools
  â†“
  Agent é€šè¿‡ AFS æ¥å£è®¿é—®èµ„æº

è¿è¡Œé˜¶æ®µï¼š
  Agent è¿è¡Œåœ¨ AINE ä¸Š
  â†“
  AINE åŒ…å« AFSDï¼ˆä¸–ç•Œå®¿ä¸»ï¼‰
  â†“
  Agent é€šè¿‡ AFS è¯»å†™ä¸–ç•Œã€æ‰§è¡Œæ“ä½œ
  â†“
  Agent ç”Ÿæˆ reportsã€viewsã€indexes

å±•ç¤ºé˜¶æ®µï¼š
  Human é€šè¿‡ AFS-UI çœ‹åˆ° AFS ä¸–ç•Œ
  â†“
  Web/CLI/å…¶ä»– UI éƒ½æ˜¯ç­‰ä»·æŠ•å½±
  â†“
  Human å’Œ Agent çœ‹åˆ°ç›¸åŒçš„æ•°æ®
  â†“
  çœŸæ­£çš„ Human-AI åä½œ
```

### AFS-UI æ ¸å¿ƒåŸåˆ™

```
UI ä¸åˆ›é€ æ•°æ®ï¼Œåªæ˜¯ AFS çš„æŠ•å½±ã€‚
UI ä¸è®¡ç®—ï¼Œåªæ¸²æŸ“ã€‚
```

**ä¼ ç»Ÿ vs AFS-UI**ï¼š

| ä¼ ç»Ÿ | AFS-UI |
|-----|--------|
| UI æŸ¥è¯¢æ•°æ®åº“ã€è®¡ç®—ã€æ¸²æŸ“ | UI è¯»å– AFS è·¯å¾„ã€ç›´æ¥æ¸²æŸ“ |
| "æœ‰ 5 ä¸ª active tasks" â†’ UI è®¡ç®— | è¯»å– `/views/active-tasks.md` â†’ æ¸²æŸ“ |
| æ•°æ®å’Œè§†å›¾è€¦åˆ | æ•°æ®å’Œè§†å›¾åˆ†ç¦» |
| AI éš¾ä»¥å‚ä¸ UI | AI ç”Ÿæˆ viewsï¼ŒUI æ¸²æŸ“ |
| æ¢ UI å¯èƒ½ä¸¢æ•°æ® | æ•°æ®å§‹ç»ˆåœ¨ AFSï¼ŒUI å¯éšæ—¶æ¢ |

**ä¸‰ç§ç­‰ä»·çš„ UI**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AFS World                            â”‚
â”‚         /data/*    /views/*    /reports/*                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚           â”‚           â”‚
                    â–¼           â–¼           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Web UI â”‚ â”‚   CLI   â”‚ â”‚  Agent  â”‚
              â”‚  (äººç±»)  â”‚ â”‚(äºº/è„šæœ¬)â”‚ â”‚  (AI)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚           â”‚           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    éƒ½æ˜¯å¯¹ AFS çš„æŠ•å½±
                    çœ‹åˆ°ç›¸åŒçš„ä¸–ç•Œ
```

### ä¸ºä»€ä¹ˆè¿™ä¸ªä½“ç³»å¼ºå¤§

**1. AI-native å…¨æ ˆ**
```
ä¸æ˜¯ 4 ä¸ªç‹¬ç«‹äº§å“
è€Œæ˜¯ AI æ—¶ä»£çš„å®Œæ•´æŠ€æœ¯æ ˆ

AIGNE  â†’ å¼€å‘æ—¶ï¼ˆæ„å»º Agentï¼‰
AINE   â†’ è¿è¡Œæ—¶ï¼ˆè¿è¡Œ Agentï¼‰
AFS    â†’ æ•°æ®å±‚ï¼ˆè®¿é—®ä¸–ç•Œï¼‰
AFS-UI â†’ å±•ç¤ºå±‚ï¼ˆHuman è§†å›¾ï¼‰
```

**2. Human å’Œ AI çœŸæ­£åä½œ**
```
Human å’Œ Agent é€šè¿‡ AFS è®¿é—®åŒä¸€ä¸ªä¸–ç•Œ
Human é€šè¿‡ AFS-UI çœ‹åˆ° Agent çš„äº§å‡º
Agent å¯ä»¥çœ‹åˆ° Human çš„æ“ä½œ
ä¸æ˜¯"AI è¾…åŠ©äººç±»"ï¼Œè€Œæ˜¯"Human-AI å¹³ç­‰åä½œ"
```

**3. ç®€å•è€Œç»Ÿä¸€çš„æŠ½è±¡**
```
Agent åªéœ€è¦ç†è§£ï¼š
- read/write/list/exec/explain
- è·¯å¾„ï¼ˆå‘½åç©ºé—´ï¼‰
- Metadata

ä¸éœ€è¦å­¦ä¹  100 ä¸ª API
ä¸éœ€è¦ç†è§£å¤æ‚çš„çŠ¶æ€æœº
ç®€å• = å¼ºå¤§
```

**4. å¼€æ”¾è€Œå¯ç»„åˆ**
```
ä»»ä½•ä¸œè¥¿éƒ½å¯ä»¥ mount ä¸º Provider
Agent å¯ä»¥è‡ªç”±ç»„åˆèµ„æº
ä¸éœ€è¦é¢„è®¾çš„é›†æˆ
ç”Ÿæ€è‡ªç„¶ç”Ÿé•¿
```

### æŠ€æœ¯æ ˆå®šä½æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚   Unix æ—¶ä»£:  "Everything is a file"                        â”‚
â”‚               â†“                                             â”‚
â”‚   Web æ—¶ä»£:   "Everything is a URL"                         â”‚
â”‚               â†“                                             â”‚
â”‚   AI æ—¶ä»£:    "Everything is a path in AFS                  â”‚
â”‚               with read/write/exec                          â”‚
â”‚               and metadata for LLM"                         â”‚
â”‚                                                             â”‚
â”‚   + AIGNE (æ„å»º Agent)                                      â”‚
â”‚   + AINE (è¿è¡Œ Agent)                                       â”‚
â”‚   + AFS-UI (å±•ç¤ºç»™ Human)                                   â”‚
â”‚                                                             â”‚
â”‚   = AI æ—¶ä»£çš„å®Œæ•´åŸºç¡€è®¾æ–½                                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Event ç±»å‹æ±‡æ€»ï¼ˆæ›´æ–°ï¼‰

```
# è¯·æ±‚ Eventï¼ˆClient â†’ AFSDï¼‰
ReadRequest       # è¯»å–
WriteRequest      # å†™å…¥
ExecRequest       # æ‰§è¡Œ
ExplainRequest    # è§£é‡Š
Subscribe         # è®¢é˜…æ•°æ®å˜åŒ–
Unsubscribe       # å–æ¶ˆè®¢é˜…æ•°æ®å˜åŒ–
SubscribeStatus   # è®¢é˜…çŠ¶æ€å˜åŒ–ï¼ˆæ–°å¢ï¼‰
UnsubscribeStatus # å–æ¶ˆè®¢é˜…çŠ¶æ€å˜åŒ–ï¼ˆæ–°å¢ï¼‰
StatusQuery       # æŸ¥è¯¢å•ä¸ªæ“ä½œçŠ¶æ€ï¼ˆæ–°å¢ï¼‰
PendingQuery      # æŸ¥è¯¢è·¯å¾„ç›¸å…³ pending æ“ä½œï¼ˆæ–°å¢ï¼‰
Heartbeat         # å¿ƒè·³ï¼ˆæ–°å¢ï¼‰

# å“åº” Eventï¼ˆAFSD â†’ Clientï¼‰
ReadResult        # è¯»å–ç»“æœ
WriteResult       # å†™å…¥ç»“æœ
ExecStarted       # æ‰§è¡Œå¼€å§‹
ExecOutput        # æ‰§è¡Œè¾“å‡ºï¼ˆstreamingï¼‰
ExecResult        # æ‰§è¡Œç»“æœ
ExplainResult     # è§£é‡Šç»“æœ
Error             # é”™è¯¯
RouteResponse     # è·¯ç”±ä¿¡æ¯
StatusChanged     # çŠ¶æ€å˜åŒ–é€šçŸ¥ï¼ˆæ–°å¢ï¼‰
ResultReady       # ç»“æœå°±ç»ªé€šçŸ¥ï¼ˆæ–°å¢ï¼‰
StatusQueryResult # çŠ¶æ€æŸ¥è¯¢ç»“æœï¼ˆæ–°å¢ï¼‰
HeartbeatAck      # å¿ƒè·³å“åº”ï¼ˆæ–°å¢ï¼‰
```
